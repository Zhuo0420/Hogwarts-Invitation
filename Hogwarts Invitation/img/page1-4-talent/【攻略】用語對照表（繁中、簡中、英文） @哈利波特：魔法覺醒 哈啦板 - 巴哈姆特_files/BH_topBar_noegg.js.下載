var topBarType="";var topBarClass="";function NOTIFY_follow(f_type,f_uid,follow){var now=new Date;var ch_follow=(1+follow)%2;jQuery.ajax({url:"https://api.gamer.com.tw/ajax/common/home_follow_set.php",data:{at:f_type,fid:f_uid,at_v:ch_follow,time:now.getTime()},method:"POST",xhrFields:{withCredentials:true}}).done(function(rdata){var errNodes=rdata.getElementsByTagName("errMsg");if(errNodes.length){alert(errNodes[0].firstChild.nodeValue)}else if("success"===rdata.getElementsByTagName("fin")[0].firstChild.nodeValue){if(1==f_type){f_title="哈啦區發表"}if(2==f_type){f_title="創作"}if(3==f_type){f_title="推薦"}if(5==f_type){f_title="實況"}if(4==f_type){f_alt=1==ch_follow?"停止此作品所有訊息":"恢復此作品所有訊息"}else{f_alt=1==ch_follow?"取消訂閱他的"+f_title:"訂閱他的"+f_title}var target1=jQuery('[name="follow_'+f_type+"_"+f_uid+'"]');var target2=jQuery('[name="follow2_'+f_type+"_"+f_uid+'"]');var target3=jQuery('.list-item-box [name="follow_'+f_type+"_"+f_uid+'"]');var target4=jQuery('.list-item-box [name="follow2_'+f_type+"_"+f_uid+'"]');var iconState;if(ch_follow==1){iconState="on";target1.parent("div").removeClass("is-disabled");target2.parent("div").removeClass("is-disabled")}else{iconState="off";target1.parent("div").addClass("is-disabled");target2.parent("div").addClass("is-disabled")}target1.attr("href","javascript:NOTIFY_follow('"+f_type+"', '"+f_uid+"', "+ch_follow+")").html('<img src="https://i2.bahamut.com.tw/rss-'+iconState+'.svg" title="'+f_alt+'" />');target2.attr("href","javascript:NOTIFY_follow('"+f_type+"', '"+f_uid+"', "+ch_follow+")").html('<img src="https://i2.bahamut.com.tw/rss-'+iconState+'.svg" style="width:16px;" title="'+f_alt+'" />');if(target3.length!=0||target4.length!=0){target3.html('<img src="https://i2.bahamut.com.tw/rss-'+iconState+'.svg" style="width:16px;" title="'+f_alt+'"/>'+f_alt);target4.html('<img src="https://i2.bahamut.com.tw/rss-'+iconState+'.svg" style="width:16px;" title="'+f_alt+'"/>'+f_alt)}}})}(function($,window,undefined){"use strict";var notification={onoff:function(notifyType,notifyId,oo,removeTag){removeTag=removeTag||"";if(removeTag){if($(oo).attr("data-switch")!=1){Dialogify.alert("已移除標記!");return false}var _url="https://api.gamer.com.tw/ajax/common/notify_remove_tag.php"}else{var _url="https://api.gamer.com.tw/ajax/common/notify_onoff.php"}$.ajax({url:_url,method:"get",data:{type:notifyType,id:notifyId,onoff:$(oo).attr("data-switch")},cache:false,xhrFields:{withCredentials:true}}).done(function(result){if(typeof result.error!="undefined"){return""}var _newType=$(oo).attr("data-switch")==1?0:1;var target1=$("[name=icon_"+notifyType+"_"+notifyId+"]");var target2=$("[name=icon2_"+notifyType+"_"+notifyId+"]");var target3=$('.list-item-box [name="icon_'+notifyType+"_"+notifyId+'"]');var target4=$('.list-item-box [name="icon2_'+notifyType+"_"+notifyId+'"]');var iconState;if(_newType==1){iconState="on";target1.parent("div").removeClass("is-disabled");target2.parent("div").removeClass("is-disabled")}else{iconState="off";target1.parent("div").addClass("is-disabled");target2.parent("div").addClass("is-disabled")}if(removeTag){var _alt=_newType==1?"移除標記":"已移除標記";target1.attr("data-switch",_newType).html('<img src="https://i2.bahamut.com.tw/wall-tag-'+iconState+'.png" title="'+_alt+'">');target2.attr("data-switch",_newType).html('<img src="https://i2.bahamut.com.tw/wall-tag-'+iconState+'.png" style="width:16px; height:16px;" title="'+_alt+'">');if(target3.length!=0||target4.length!=0){target3.html('<img src="https://i2.bahamut.com.tw/wall-tag-'+iconState+'.png" style="width:16px; height:16px;" title="'+_alt+'"/>'+_alt);target4.html('<img src="https://i2.bahamut.com.tw/wall-tag-'+iconState+'.png" style="width:16px; height:16px;" title="'+_alt+'"/>'+_alt)}}else{var _alt=_newType==1?"停止這則通知":"開啟這則通知";target1.attr("data-switch",_newType).html('<img src="https://i2.bahamut.com.tw/sound-'+iconState+'.svg?_=1" title="'+_alt+'">');target2.attr("data-switch",_newType).html('<img src="https://i2.bahamut.com.tw/sound-'+iconState+'.svg?_=1" style="width:16px;" title="'+_alt+'">');if(target3.length!=0||target4.length!=0){target3.html('<img src="https://i2.bahamut.com.tw/sound-'+iconState+'.svg" style="width:16px;" title="'+_alt+'"/>'+_alt);target4.html('<img src="https://i2.bahamut.com.tw/sound-'+iconState+'.svg" style="width:16px;" title="'+_alt+'"/>'+_alt)}}})}};window.bahaNotification=notification})(jQuery,window);function topNotify_follow(owner,c1,c2,c3,c4,c5){if(!User.Login.requireLogin()){return}c1=c1||"checked";c2=c2||"checked";c3=c3||"checked";c4=c4||"checked";c5=c5||"checked";new Dialogify('<input id="c1" type="checkbox" value="1" '+c1+'/>叭啦叭啦<input style="margin-left:15px" id="c2" type="checkbox" value="2" '+c2+'/>哈啦區發表<input style="margin-left:15px" id="c3" type="checkbox" value="4" '+c3+'/>小屋發表<br><br><input id="c4" type="checkbox" value="16" '+c4+'/>他的推薦<input style="margin-left:15px" id="c5" type="checkbox" value="32" '+c5+"/>實況頻道").title("追蹤動態").buttons([{text:"確定",type:Dialogify.BUTTON_PRIMARY,click:function(e){var v=0;if(jQuery("#c1").is(":checked")){v=v|jQuery("#c1").val()}if(jQuery("#c2").is(":checked")){v=v|jQuery("#c2").val()}if(jQuery("#c3").is(":checked")){v=v|jQuery("#c3").val()}if(jQuery("#c4").is(":checked")){v=v|jQuery("#c4").val()}if(jQuery("#c5").is(":checked")){v=v|jQuery("#c5").val()}getCSRFToken().done(function(token){jQuery.ajax({url:"https://api.gamer.com.tw/ajax/common/home_follow_add.php",method:"POST",data:{who:owner,v:v,token:token},xhrFields:{withCredentials:true}}).done(function(text){Dialogify.alert(text)})})}}]).showModal()}var BH_AlkasooD=function(jq){function toCode62(n){var code62Map=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];return code62Map[n]}function fromCode62(code){if(code=="-"){return-1}var n=code.charCodeAt(0);if(n>=48&&n<=57){n-=48}else if(n>=65&&n<=90){n-=55}else if(n>=97&&n<=122){n-=61}else{n=-1}return n}function generateCkGamerAdString(ck,cookiePos,adIndex){var CK_GAMER_AD_LENGTH=25;var ckStr=ck||"";var i;if(ck==""){for(i=0;i<CK_GAMER_AD_LENGTH;i++){ckStr+="-"}}ckStr=ckStr.substring(0,cookiePos)+toCode62(adIndex)+ckStr.substring(cookiePos+1);return escape(ckStr)}var bahaADnum=Cookies.get("ckBahaAd");var setflagc=false;var setflagc2=false;var oo={};jq("a.a-mercy-d").each(function(){var info=jq(this).data("mercy");if(info){var str=info.split(":");if(str[0]&&str[1]){str[0]=parseInt(str[0],10);str[1]=parseInt(str[1],10);bahaADnum=generateCkGamerAdString(bahaADnum,str[0],str[1]);setflagc=true}}var info2=jq(this).data("si");if(info2){var str=info2.split(":");var pos=str[0];if(typeof str[1]!=="undefined"){var s2=str[1].split(",");jq.each(s2,function(i,v){var vvv=v.split("_");jq.extend(true,oo,JSON.parse('{"'+pos+'":{"'+vvv[0]+'":"'+vvv[1]+'"}}'));setflagc2=true})}}});var date=new Date;var cookieExpires=new Date(date.getFullYear(),date.getMonth(),date.getDate(),23,59,59);if(setflagc2){var bahaAD2str=Cookies.get("ckBAHAADS");if(!bahaAD2str){Cookies.set("ckBAHAADS",JSON.stringify(oo),{expires:cookieExpires,path:"/",domain:".gamer.com.tw"})}else{var adlist=JSON.parse(bahaAD2str);jq.extend(true,adlist,oo);Cookies.set("ckBAHAADS",JSON.stringify(adlist),{expires:cookieExpires,path:"/",domain:".gamer.com.tw"})}}if(setflagc){Cookies.set("ckBahaAd",bahaADnum,{expires:cookieExpires,path:"/",domain:".gamer.com.tw"})}};(function(window,undefined){var AntiAD=function(options){this._options={resetOnEnd:false,loopCheckTime:50,loopMaxNumber:2,baitClass:"pub_300x250 pub_300x250m pub_728x90 text-ad textAd text_ad text_ads text-ads text-ad-links",baitStyle:"width: 1px !important; height: 1px !important; position: absolute !important; left: -10000px !important; top: -1000px !important;"};this._var={bait:null,checking:false,loop:null,loopNumber:0,event:{detected:[],notDetected:[]}};if(options!==undefined){this.setOption(options)}var self=this;var eventCallback=function(){setTimeout(function(){if(self._var.bait===null){self._creatBait()}setTimeout(function(){self._check()},1)},1)};if(window.addEventListener!==undefined){window.addEventListener("load",eventCallback,false)}else{window.attachEvent("onload",eventCallback)}};AntiAD.prototype._options=null;AntiAD.prototype._var=null;AntiAD.prototype._bait=null;AntiAD.prototype.setOption=function(options){for(var option in options){this._options[option]=options[option]}return this};AntiAD.prototype._creatBait=function(){var bait=document.createElement("div");bait.setAttribute("class",this._options.baitClass);bait.setAttribute("style",this._options.baitStyle);this._var.bait=window.document.body.appendChild(bait);this._var.bait.offsetParent;this._var.bait.offsetHeight;this._var.bait.offsetLeft;this._var.bait.offsetTop;this._var.bait.offsetWidth;this._var.bait.clientHeight;this._var.bait.clientWidth};AntiAD.prototype._destroyBait=function(){window.document.body.removeChild(this._var.bait);this._var.bait=null};AntiAD.prototype._check=function(loop){if(loop===undefined){loop=true}if(this._var.checking===true){return false}this._var.checking=true;if(this._var.bait===null){this._creatBait()}var self=this;this._var.loopNumber=0;if(loop===true){this._var.loop=setInterval(function(){self._checkBait(loop)},this._options.loopCheckTime)}setTimeout(function(){self._checkBait(loop)},1);return true};AntiAD.prototype._checkBait=function(loop){var detected=false;if(this._var.bait===null){this._creatBait()}if(window.document.body.getAttribute("abp")!==null||this._var.bait.offsetParent===null||this._var.bait.offsetHeight==0||this._var.bait.offsetLeft==0||this._var.bait.offsetTop==0||this._var.bait.offsetWidth==0||this._var.bait.clientHeight==0||this._var.bait.clientWidth==0){detected=true}if(window.getComputedStyle!==undefined){var baitTemp=window.getComputedStyle(this._var.bait,null);if(baitTemp&&(baitTemp.getPropertyValue("display")=="none"||baitTemp.getPropertyValue("visibility")=="hidden")){detected=true}}if(loop===true){this._var.loopNumber++;if(this._var.loopNumber>=this._options.loopMaxNumber){this._stopLoop()}}if(detected===true){this._stopLoop();this._destroyBait();this.emitEvent(true);if(loop===true){this._var.checking=false}}else if(this._var.loop===null||loop===false){this._destroyBait();this.emitEvent(false);if(loop===true){this._var.checking=false}}};AntiAD.prototype._stopLoop=function(detected){clearInterval(this._var.loop);this._var.loop=null;this._var.loopNumber=0};AntiAD.prototype.emitEvent=function(detected){var fns=this._var.event[detected===true?"detected":""];for(var i in fns){if(fns.hasOwnProperty(i)){fns[i]()}}if(this._options.resetOnEnd===true){this.clearEvent()}return this};AntiAD.prototype.clearEvent=function(){this._var.event.detected=[];this._var.event.notDetected=[]};AntiAD.prototype.on=function(detected,fn){this._var.event[detected===true?"detected":"notDetected"].push(fn);return this};AntiAD.prototype.onDetected=function(fn){return this.on(true,fn)};AntiAD.prototype.onNotDetected=function(fn){return this.on(false,fn)};window.AntiAdB=AntiAD;if(window.antiadb===undefined){window.antiadb=new AntiAD({resetOnEnd:true})}})(window);(function($,window,undefined){"use strict";var TopBar=window.TopBar||{};var BAHAID=Cookies.get("BAHAID");if(BAHAID){BAHAID=BAHAID.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}TopBar.render=function(s){var html="";var $topbar=$(".TOP-my");if(BAHAID){if(typeof jQuery().slick!=="function"){let slickScript=document.createElement("script");slickScript.type="text/javascript";slickScript.src="https://i2.bahamut.com.tw/js/plugins/slick-1.9.0.min.js";document.getElementsByTagName("head")[0].append(slickScript);let slickCss=document.createElement("link");slickCss.type="text/css";slickCss.rel="stylesheet";slickCss.href="https://i2.bahamut.com.tw/css/plugins/slick.css";document.getElementsByTagName("head")[0].append(slickCss)}var avatarUrl=User.Login.getAvatarUrl();html+="<ul>";html+='<li class="mobilehide"><a id="topBar_mailbox" href="https://mailbox.gamer.com.tw/"><span class="text-tooltip">站內信</span><img src="https://i2.bahamut.com.tw/top_icon3.png"></a></li>';html+='<li class="mobilehide"><a id="topBar_forum" href="javascript:TopBar.showMenu(\'forum\', \'\')"><span class="text-tooltip">我的看板及公會</span><img src="https://i2.bahamut.com.tw/top_icon4.png"></a></li>';html+='<li><a class="topbar_member-home" href="https://home.gamer.com.tw/homeindex.php" data-gtm="勇者頭像"><span class="text-tooltip">我的小屋</span><div class="nav-member_imgbox"><img src="'+avatarUrl+'" /></div></a><a id="topBar_member" class="topbar_member mobilehide" href="javascript:TopBar.showMenu(\'member\', \'topbar_member\')"><i class="fa fa-angle-down"></i><span class="text-tooltip">勇者捷徑</span></a></li>';html+='<li><a id="topBar_more" style="font-size:11px;" href="javascript:TopBar.showMenu(\'more\', \'\')"><img src="https://i2.bahamut.com.tw/menu.gif"></a></li>';html+="</ul>";html+="</div>";$topbar.html(html);html="";html+='<p class="TOP-btn">';html+='<a href="javascript:TopBar.showMenu(\'light_0\', \'topb1\', \' topbnow1 topbnow\')" id="topBar_light_0" class="topb1" data-tooltiptext="通知"><span class="text-tooltip">通知</span></a>';html+='<a href="javascript:TopBar.showMenu(\'light_1\', \'topb2 mobilehide\', \' topbnow2 topbnow\')" id="topBar_light_1" class="topb2 mobilehide" data-tooltiptext="訂閱"><span class="text-tooltip">訂閱</span></a>';html+='<a href="javascript:TopBar.showMenu(\'light_2\', \'topb3 mobilehide\', \' topbnow3 topbnow\')" id="topBar_light_2" class="topb3 mobilehide" data-tooltiptext="推薦"><span class="text-tooltip">推薦</span></a>';html+='<a href="javascript:TopBar.showMenu(\'hahamut\', \'topb4\')" id="topBar_hahamut" class="topb4" style="display:none" data-tooltiptext="聊天"><span class="text-tooltip">聊天</span></a>';html+="</p>";html+='<div id="topBar_search" class="mobileshow nav-search">';html+='<div class="nav-search-button topb5" style="display: block;" onclick="TopBar.showSearchBar();">';html+='<i class="nav-search-icon"></i>';html+="</div>";html+="</div>";html+='<div id="topBarMsg_forum" style="display:none" class="TOP-msg"></div>';html+='<div id="topBarMsg_guild" style="display:none" class="TOP-msg"></div>';html+='<div id="topBarMsg_light_0" style="display:none" class="TOP-msg"></div>';html+='<div id="topBarMsg_light_1" style="display:none" class="TOP-msg"></div>';html+='<div id="topBarMsg_light_2" style="display:none" class="TOP-msg"></div>';html+='<div id="topBarMsg_member" style="display:none" class="TOP-msg"></div>';html+='<div id="topBarMsg_hahamut" style="display:none" class="TOP-msg"></div>';$(html).insertAfter($topbar)}else{$topbar.addClass("TOP-nologin");html+='<a href="https://user.gamer.com.tw/login.php"><img src="https://i2.bahamut.com.tw/none.gif"></a>';html+="<ul>";html+='<li><a href="https://user.gamer.com.tw/login.php">我要登入</a></li>';html+='<li><a href="https://user.gamer.com.tw/regS1.php?click_name=全站天註冊&service_name='+window.location.host.split(".")[0]+'">註冊</a></li>';html+='<li><a id="topBar_more" style="font-size:11px;" href="javascript:TopBar.showMenu(\'more\', \'\')"><img src="https://i2.bahamut.com.tw/menu.gif"></a></li>';html+="</ul>";html+="</div>";$topbar.html(html);html="";html+='<div id="topBar_search" class="mobileshow nav-search">';html+='<div class="nav-search-button topb5" style="display: block;" onclick="TopBar.showSearchBar();">';html+='<i class="nav-search-icon"></i>';html+="</div>";html+="</div>";$(html).insertAfter($topbar)}var secondNav=$("#BH-menu-path");if(secondNav.length>0){secondNav.addClass("box-shadow__soft")}else{$(".TOP-bh").addClass("box-shadow__soft")}$("body").click(function(event){if(!$(event.target).parents(".TOP-btn,.TOP-my,.TOP-msg").length){TopBar.closeMenu()}})};TopBar.getNotifyNumber=function(){this.getNotificationNumber()};TopBar.showSearchBar=function(){$("#js-SearchForm").fadeIn("normal");$(".nav-search-button").fadeOut("normal")};TopBar.hideSearchBar=function(){$("#js-SearchForm").fadeOut("normal");$(".nav-search-button").fadeIn("normal")};TopBar.showMenu=function(type,d_class,now_class=" topbnow"){let $topbar=$("#topBar_"+type);let $topbarMsg=$("#topBarMsg_"+type);if("none"==$topbarMsg.css("display")){this.closeMenu();$topbar.addClass(d_class+now_class+" is-open");$topbarMsg.css("display","block");if(""==$topbarMsg.html()||"<span>"==$topbar.html().substr(0,6)||type=="hahamut"){if("more"==type){let menu_content="";menu_content+='\x3c!--[if (IE 7)|(IE 8)]><style type="text/css">.TOP-msglist{ max-height:450px;}</style><![endif]--\x3e';menu_content+='<div class="TOP-msglist TOP-more" id="topBarMsgList_more">\x3c!--列表開始--\x3e';if(BAHAID){menu_content+='<div class="mobileshow mobile-top_other">';menu_content+="<p>勇者捷徑</p>";menu_content+="<ul>";menu_content+='<li><a href="https://home.gamer.com.tw/notifylist.php?owner='+BAHAID+'&t=B"><i class="fa fa-rss-square"></i>我的訂閱</a></li>';menu_content+='<li><a href="https://home.gamer.com.tw/notifylist.php?owner='+BAHAID+'&t=C"><i class="fa fa-thumbs-up"></i>我的推薦</a></li>';menu_content+='<li><a href="https://forum.gamer.com.tw/myBoard.php"><i class="fa fa-tags"></i>我的看板</a></li>';menu_content+='<li><a href="https://home.gamer.com.tw/joinGuild.php"><i class="fa fa-tags"></i>我的公會</a></li>';menu_content+='<li><a href="https://mailbox.gamer.com.tw/"><i class="fa fa-envelope"></i>我的信箱</a></li>';menu_content+='<li><a href="https://home.gamer.com.tw/bookmark.php?owner='+BAHAID+'"><i class="fa fa-bookmark"></i>我的收藏</a></li>';menu_content+='<li><a href="https://home.gamer.com.tw/acgbox.php?owner='+BAHAID+'"><i class="fa fa-heart"></i>我的追蹤</a></li>';menu_content+='<li><a href="https://avatar1.gamer.com.tw/wardrobe.php"><i class="fa fa-archive"></i>我的衣櫃</a></li>';menu_content+='<li><a href="https://user.gamer.com.tw/editProfile_ssl.php"><i class="fa fa-user"></i>會員資料</a></li>';menu_content+='<li><a href="https://home.gamer.com.tw/homeSecuritySet.php"><i class="fa fa-lock"></i>帳號安全</a></li>';menu_content+='<li><a href="https://home.gamer.com.tw/setting.php"><i class="fa fa-cog"></i>偏好設定</a></li>';menu_content+="</ul>";menu_content+="</div>"}menu_content+="<div>";menu_content+="<p>站上服務</p>";menu_content+="<ul>";menu_content+='<li><a href="//gnn.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-gnn.svg">GNN新聞</a></li>';menu_content+='<li><a href="//forum.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-forum.svg">哈啦區</a></li>';menu_content+='<li><a href="//haha.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-ey.svg">哈哈姆特不EY</a></li>';menu_content+='<li><a href="//wall.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-wall.svg">動態牆</a></li>';menu_content+='<li><a href="//gnn.gamer.com.tw/gamecrazy.php" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-gamecrazy.svg">電玩瘋</a></li>';menu_content+='<li><a href="//ani.gamer.com.tw/" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-ani.svg">動畫瘋</a></li>';menu_content+='<li><a href="//home.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-creat.svg">創作大廳</a></li>';menu_content+='<li><a href="//home.gamer.com.tw/liveindex.php" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-live.svg">實況大廳</a></li>';menu_content+='<li><a href="//guild.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-guild.svg">公會大廳</a></li>';menu_content+='<li><a href="//avatar1.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-avatar.svg">勇者造型</a></li>';menu_content+='<li><a href="//buy.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-buy.svg">巴哈商城</a></li>';menu_content+='<li><a href="//fuli.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-fuli.svg">勇者福利社</a></li>';menu_content+='<li><a href="//prj.gamer.com.tw/app2u/bahaapp.html" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-bh.svg">ＡＰＰ</a></li>';menu_content+='<li><a href="//prj.gamer.com.tw/acgaward" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-prj.svg">ACG創作大賽</a></li>';menu_content+='<li><a href="//user.gamer.com.tw" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-user.svg">會員中心</a></li>';menu_content+='<li><a href="//user.gamer.com.tw/help/tellus.php" data-gtm="服務入口"><img src="https://i2.bahamut.com.tw/nav-qa.svg">問題回報</a></li>';menu_content+="</ul>";menu_content+="</div>";menu_content+='<div class="nav-platform">';menu_content+="<p>平台專區</p>";menu_content+="<ul>";menu_content+='<li class="platform-android"><a href="//acg.gamer.com.tw/android"><i class="fa fa-android" aria-hidden="true"></i>Android</a></li>';menu_content+='<li class="platform-apple"><a href="//acg.gamer.com.tw/ios"><i class="fa fa-apple" aria-hidden="true"></i>iOS</a></li>';menu_content+='<li class="platform-ns"><a href="//acg.gamer.com.tw/switch">Switch</a></li>';menu_content+='<li class="platform-ps"><a href="//acg.gamer.com.tw/ps5">PS5</a></li>';menu_content+='<li class="platform-ps"><a href="//acg.gamer.com.tw/ps4">PS4</a></li>';menu_content+='<li class="platform-olg"><a href="//acg.gamer.com.tw/online">PC 線上</a></li>';menu_content+='<li class="platform-pc"><a href="//acg.gamer.com.tw/pc">PC 單機</a></li>';menu_content+='<li class="platform-web"><a href="//acg.gamer.com.tw/web">Web</a></li>';menu_content+='<li class="platform-xbox"><a href="//acg.gamer.com.tw/xboxsx">XboxSX</a></li>';menu_content+='<li class="platform-ac"><a href="//acg.gamer.com.tw/anime">動畫</a></li>';menu_content+='<li class="platform-ac"><a href="//acg.gamer.com.tw/comic">漫畫</a></li>';menu_content+='<li class="platform-ac"><a href="//acg.gamer.com.tw/lightnovel">輕小說</a></li>';menu_content+="</ul>";menu_content+="</div>";menu_content+="</div>\x3c!--列表結束--\x3e";if(BAHAID){menu_content+='<p class="TOP-msgbtn mobileshow"><a href="https://user.gamer.com.tw/logout.php"><i class="fa fa-sign-out" aria-hidden="true"></i>登出</a></p>'}$topbar.addClass("topbnow_arrow");$topbarMsg.addClass("TOP-msg").html(menu_content)}else if(type=="hahamut"){$topbar.html(`<span class="text-tooltip">${$topbar.data("tooltiptext")}</span>`);$topbarMsg.html('<span>哈哈姆特不EY - 聊天</span><div class="TOP-msglist im_top-sort" id="topBarHahamut"></div><p class="TOP-msgbtn trisection"><a id="im_friend_apply" href="https://haha.gamer.com.tw/?room=friend"><i class="material-icons im_bhtop">group</i>好友</a><a href="https://haha.gamer.com.tw/?room=chat"><i class="material-icons im_bhtop">fullscreen</i>開啟完整版</a><a href="https://prj.gamer.com.tw/app2u/hahaapp.html" target="_blank"><i class="material-icons im_bhtop">get_app</i>下載APP</a></p>');setTimeout(function(){ImTop.showlist();ImTop.close()},0);$topbar.addClass("topbnow_arrow");$topbarMsg.css("display","block")}else{$.ajax({url:"https://api.gamer.com.tw/ajax/common/topBar.php",data:{type:type},method:"GET",xhrFields:{withCredentials:true}}).done(function(rdata){let html="";switch(type){case"forum":$topbarMsg.css({"max-width":"835px",width:"200px"});if(rdata){let device_width=window.innerWidth>0?window.innerWidth:screen.width;let max_width=device_width<=1024?635:835;let guild_slides_to_show=4;let guild_slides_to_show_map={415:5,635:7,645:8,835:10};if(!rdata.match(/<div class="empty-item">/i)){let boardCount=rdata.match(/<a href="(?:https?:)?\/\/forum\.gamer\.com\.tw\/A\.php/gi).length;let length_px=boardCount<=20?415:Math.ceil(boardCount/10)*215;length_px=length_px<max_width?length_px:max_width;$topbarMsg.css("width",`${length_px}px`);guild_slides_to_show=guild_slides_to_show_map[length_px]}html=`\n                              <link href="https://i2.bahamut.com.tw/css/guild_create_dialogify.css" rel="stylesheet" type="text/css">\n                              <script src="https://i2.bahamut.com.tw/js/guild.js"><\/script>\n                              <span>我的巴哈社群<div onclick="guildSliderShow(event)" class="nav_toggle" id="guild_slider_toggle"><i class="fa fa-minus-square-o" aria-hidden="true"></i> 隱藏公會</div></span>\n                              <div class="TOP-msglist TOP-board" id="topBarMsgList_${type}">${rdata}</div>\n                              <p class="TOP-msgbtn">\n                                  <a href="https://home.gamer.com.tw/setting/forum_edit_board.php" target="_blank">編輯/刪除看板</a><a href="//forum.gamer.com.tw">前往哈啦區</a><a href="//guild.gamer.com.tw">前往公會大廳</a>\n                              </p>\n                              <style>.slick-disabled {display: none !important;}</style>\n                              <script>\n                                  jQuery(".guild_slider").slick({\n                                      dots: false, arrows: true, infinite: false, speed: 300,\n                                      slidesToShow: ${guild_slides_to_show}, slidesToScroll: ${guild_slides_to_show}\n                                  });\n                                  function guildSliderShow(event) {\n                                    if (event !== undefined) event.stopPropagation();\n                                    if (jQuery('#guild_slider').is(":hidden")) {\n                                      jQuery('#guild_slider').show();\n                                      // set whatever option make slick reflash\n                                      jQuery(".guild_slider").slick('slickSetOption', 'speed', 300, true);\n                                      jQuery('#guild_slider_toggle').html('<i class="fa fa-minus-square-o" aria-hidden="true"></i> 隱藏公會');\n                                      Cookies.set('ck_guildSliderHide', 'false', {expires: 365, path: '/', domain:'.gamer.com.tw'});\n                                      return;\n                                    }\n                                    jQuery('#guild_slider').hide();\n                                    jQuery('#guild_slider_toggle').html('<i class="fa fa-plus-square-o" aria-hidden="true"></i> 顯示公會');\n                                    Cookies.set('ck_guildSliderHide', 'true', {expires: 365, path: '/', domain:'.gamer.com.tw'});\n                                  }\n                                  if (Cookies.get('ck_guildSliderHide') === 'true') {\n                                    guildSliderShow();\n                                  }\n                              <\/script>\n                              `}break;case"member":html=rdata;break;case"light_0":case"light_1":case"light_2":$topbar.html(`<span class="text-tooltip">${$topbar.data("tooltiptext")}</span>`);let title="",code="";switch(type){case"light_0":title="通知";code="A";new NotificationNotice(0).titleNotice().faviconNotice();break;case"light_1":title="訂閱";code="B";break;case"light_2":title="推薦";code="C";break}html="<span>"+title+'</span>\x3c!--[if (IE 7)|(IE 8)]><style type="text/css">.TOP-msglist{ max-height:450px;}</style><![endif]--\x3e<div class="TOP-msglist" id="topBarMsgList_'+type+'">'+rdata+'</div><p class="TOP-msgbtn"><a href="//home.gamer.com.tw/notifylist.php?owner='+Cookies.get("BAHAID")+"&t="+code+'"><i class="fa fa-bars" aria-hidden="true"></i>看所有通知</a><a href="//home.gamer.com.tw/setFavorite1.php#anc_notifyset"><i class="fa fa-cog" aria-hidden="true"></i>設定</a></p>';break}$topbarMsg.html(html);channel.port1.postMessage({action:"syncTab",data:{type:type,html:html}});$topbar.addClass("topbnow_arrow");$topbarMsg.css("display","block")})}}else{if(type=="forum"){let length_px=200;let device_width=window.innerWidth>0?window.innerWidth:screen.width;let max_width=device_width<=1024?635:835;if(!$topbarMsg.html().match(/<div class="empty-item">/i)){let boardCount=$topbarMsg.html().match(/<a href="(?:https?:)?\/\/forum\.gamer\.com\.tw\/A\.php/gi).length;length_px=boardCount<=20?415:Math.ceil(boardCount/10)*215;length_px=length_px<max_width?length_px:max_width}$topbarMsg.css({"max-width":"835px",width:`${length_px}px`});jQuery(".guild_slider").slick("slickSetOption","speed",300,true)}$topbar.addClass("topbnow_arrow");$topbarMsg.css("display","block")}}else{this.closeMenu()}};TopBar.syncTab=function(syncData){let clean_number=["light_0","light_1","light_2","hahamut"];let $topbar=$("#topBar_"+syncData.type);let $topbarMsg=$("#topBarMsg_"+syncData.type);$topbarMsg.html(syncData.html);if(clean_number.includes(syncData.type)){$topbar.html("")}if(syncData.type=="light_0"){new NotificationNotice(0).titleNotice().faviconNotice()}if($topbarMsg.css("display")==="none"){$topbar.removeClass(function(e,className){return(className.match(/topbnow[0-3]/g)||[]).join(" ")})}};TopBar.closeMenu=function(){$(".TOP-btn a.is-open,.TOP-my a.is-open").removeClass(function(e,className){return(className.match(/(topbnow(_arrow|[0-4])?|topbtn[0-3]now)/g)||[]).join(" ")}).removeClass("is-open");$("div.TOP-msg").css("display","none")};TopBar.showNotificationNumber=function(number=[0,0,0]){const onClass=[" topbnow1"," topbnow2 mobilehide"," topbnow3 mobilehide"];const offClass=[" topb1"," topb2 mobilehide"," topb3 mobilehide"];new NotificationNotice(number[0]).titleNotice().faviconNotice();for(let i=0,l=number.length;i<=l;i++){let $light=$("#topBar_light_"+i);let $msg=$("#topBarMsg_light_"+i);if(number[i]>0){$light.addClass("topb"+(i+1)+onClass[i]).html(`<span>${number[i]}</span><span class="text-tooltip">${$light.data("tooltiptext")}</span>`)}else{if($msg.css("display")==="none"){$light.removeClass().addClass("topb"+(i+1+offClass[i])).html(`<span class="text-tooltip">${$light.data("tooltiptext")}</span>`)}}}};TopBar.getNotificationNumber=function(){if(BAHAID){channel.port1.postMessage({action:"getNotificationNumber"})}};if(BAHAID){var channel=new MessageChannel;var workerFrame=document.createElement("iframe");workerFrame.src="https://api.gamer.com.tw/worker/top_bar.html?v=2022111501";workerFrame.onload=function(){this.contentWindow.postMessage("BahamutTopBarInit","https://api.gamer.com.tw",[channel.port2])};channel.port1.onmessage=function(e){if(e.data.action==="ping"){channel.port1.postMessage({action:"pong",data:e.data.data})}if(typeof TopBar[e.data.action]==="function"){TopBar[e.data.action](e.data.data)}};workerFrame.style.display="none";document.body.appendChild(workerFrame)}class NotificationNotice{constructor(num){this.faviconUrl="/favicon.ico";this.iconUrl="https://i2.bahamut.com.tw/favicon_reddot.png";this.num=+num;if(isNaN(this.num)){this.num=0}}setFaviconUrl(faviconUrl){this.faviconUrl=faviconUrl}titleNotice(){let title="";if(this.num>0){title=`(${this.num}) `}let matches=window.document.title.match(/^\(\d+\) /);if(matches){title=`${title}${window.document.title.substring(matches[0].length)}`}else{title=`${title}${window.document.title}`}window.document.title=title;return this}faviconNotice(){let $icon=$("#notificationNotice");if(this.num==0){if($icon.length&&$icon.attr("href")!=this.faviconUrl){$icon.attr("href",this.faviconUrl)}return}if($icon.length){if($icon.attr("href")!=this.iconUrl){$icon.attr("href",this.iconUrl)}}else{$("<link>").attr({id:"notificationNotice",type:"image/x-icon",rel:"icon",href:this.iconUrl}).appendTo("head")}return this}}window.TopBar=TopBar})(jQuery,window);