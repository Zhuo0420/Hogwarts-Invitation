(function(window,Cookies,Dialogify,undefined){"use strict";var Login={requireLogin:function(returnUrl,msg){msg=msg||"您必須先登入才能進行動作";if(this.isLogin()){return true}Dialogify.confirm(msg,{ok:function(){var loc=window.location;returnUrl=returnUrl||"https://"+loc.host+loc.pathname+loc.search;Cookies.set("ckFrom",returnUrl,{path:"/",domain:".gamer.com.tw"});location.href="https://user.gamer.com.tw/login.php"}});return false},requireLoginIframe:function(callback,title){title=title||"請先登入";callback=callback||function(){location.reload()};if(this.isLogin()){return true}window.addEventListener("message",function(e){let hregex=new RegExp("^bodyHeight");if(hregex.test(e.data)){let h=e.data.split(",");jQuery("dialog").find("iframe").css("height",parseInt(h[1]))}switch(e.data){case"LoginFinish":callback();break;case"LoginCancel":Dialogify.closeAll();break}},false);new Dialogify('<iframe style="min-width: 360px; min-height: 450px; border: 0;" src="https://user.gamer.com.tw/login.php"></iframe>').title(title).showModal();return false},isLogin:function(){return this.getUserid()!==""},getUserid:function(){var userid=(Cookies.get("BAHAID")||"").trim();if(!userid.match(/^[a-z][a-z0-9]{1,11}$/i)){return""}return userid==="guest"?"":userid},getAvatarUrl:function(useBig,userid){useBig=useBig||false;if(!userid){userid=this.getUserid()}if(userid===""){return useBig?"":"https://i2.bahamut.com.tw/none.gif"}userid=userid.toLowerCase();var avatarVersion=parseInt(Cookies.get("avtrv"),10);if(!avatarVersion){avatarVersion=(new Date).getTime();Cookies.set("avtrv",avatarVersion.toString(),{expires:30,domain:"gamer.com.tw"})}return"https://avatar2.bahamut.com.tw/avataruserpic/"+userid.substr(0,1)+"/"+userid.substr(1,1)+"/"+userid+"/"+userid+(useBig?"":"_s")+".png?v="+avatarVersion},getUser:function(){if(this.isLogin()){return{isLogin:true,userid:this.getUserid(),avatarLv:parseInt(Cookies.get("BAHALV")||0,10),registerTime:new Date((Cookies.get("BAHAFLT")||0)*1e3),avatarUrl:{small:this.getAvatarUrl(),big:this.getAvatarUrl(true)},nickname:Util.Html.decode(Cookies.get("BAHANICK"))}}else{return{isLogin:false,userid:"",avatarLv:0,registerTime:new Date(0*1e3),avatarUrl:{small:this.getAvatarUrl(),big:this.getAvatarUrl(true)},nickname:""}}}};window.User=window.User||{};window.User.Login=Login})(window,Cookies,Dialogify);