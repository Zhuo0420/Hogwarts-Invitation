(function(window,$){"use strict";const ACTION_INSERT=1;const ACTION_UPLOAD=2;const ACTION_SELECT=3;const ACTION_CROP_UPLOAD=4;const SELECT_SINGLE=1;const SELECT_MULTIPLE=2;const TAB_UPLOAD=1;const TAB_SELECT=2;const TAB_INSERT=3;var TruthImage=function(options){this.options=options||{};this.action=this.options.action||ACTION_INSERT;this.title=this.options.title;this.win=null;this.editor=null;this.dropzone=null;this.dropzoneSelect=null;this.hideTabs=this.options.hideTabs||[];if(this.action==ACTION_SELECT){this.selectModal=this.options.selectModal||SELECT_SINGLE}else{this.selectModal=this.options.selectModal||SELECT_MULTIPLE}if(!this.title){this.title=this.action==ACTION_UPLOAD||this.action==ACTION_CROP_UPLOAD?"上傳圖片":"插入圖片"}};TruthImage.prototype.setEditor=function(elem){if(elem!=null&&elem!=undefined){this.editor=$(elem);if(this.editor.get(0).contentWindow){this.plainText=false;this.win=this.editor.get(0).contentWindow}else if(this.editor.attr("contenteditable")){this.plainText=false;this.win=window}else if(this.editor.prop("tagName").match(/^textarea$/i)||this.editor.prop("tagName").match(/^input$/i)&&this.editor.attr("type").match(/^text$/i)){this.plainText=true;this.win=null}else{throw"unsupported element"}}};TruthImage.prototype.showDialog=function(){var dialogOptions={useDialogForm:false,size:Dialogify.SIZE_LARGE,closable:false};var self=this;this.dialog=new Dialogify("#TruthImageTemplate",dialogOptions);let $dialogContent=this.dialog.$content;$dialogContent.find(".tab-menu__3 > li").on("click",function(e){var index=$(this).index();$dialogContent.find(".tab-wrapper > div").hide().eq(index).show();$(this).addClass("active").siblings("li").removeClass("active");switch(index){case 0:$("#manage_home_image").show();break;case 1:$("#manage_home_image").hide();break;case 2:listTruthImage(self,1);$("#manage_home_image").show();break;case 3:$("#insertImageUrl").focus();$("#manage_home_image").hide();break;default:$("#manage_home_image").hide()}if(self.action!=ACTION_CROP_UPLOAD){var btn=self.dialog.$buttonList[2];if($(this).data("buttonEnabled")){btn.enable()}else{btn.disable()}}});$("#insertImageUrl").on("input",function(e){var tab=$dialogContent.find(".tab-menu__3 .tab-menu__item3");var btn=self.dialog.$buttonList[2];var msg=$(".uploadimage-url .imgbox p");var c=$(".uploadimage-url .imgbox");var pattern=/(^https:\/\/(?:.*?)\.(?:jpg|jpeg|gif|png))(?:\?[^\?]*)?$/i;var matches;if(matches=$(this).val().match(pattern)){tab.data("buttonEnabled",true);btn.enable();msg.hide();if(c.find("img").length){c.find("img").attr("src",matches[1])}else{c.append('<img src="'+matches[1]+'">')}}else{c.find("img").remove();tab.removeData("buttonEnabled");btn.disable();if($(this).val()==""){msg.hide()}else{msg.text("錯誤的圖片格式").addClass("is-error").show()}}});$("#insertImageTruthList").on("click",".imgbox",function(e){var url=$(this).prev(".check-group").find("input").val();if($('[name="insertImageCheck"]:checked').length){var isChecked=$(this).prev(".check-group").children('[name="insertImageCheck"]').prop("checked");$(this).prev(".check-group").children('[name="insertImageCheck"]').prop("checked",!isChecked).trigger("change")}else{finish(1,self,url)}});var imgCount=0;$("#insertImageTruthList").on("change",'[name="insertImageCheck"]',function(e){var btn=self.dialog.$buttonList[2];if($('[name="insertImageCheck"]:checked').length){btn.enable()}else{btn.disable()}var time=(new Date).getTime();var currentLabel=$("label[for="+$(this).attr("id")+"] > div");if($(this).is(":checked")===true){$(this).attr("data-sort",time);imgCount++;currentLabel.text(imgCount);$(this).parent().parent().addClass("is-active")}else{$(this).removeAttr("data-sort");var removedIndex=currentLabel.text();recountImageOrder(removedIndex);imgCount--;$(this).parent().parent().removeClass("is-active")}});$("#insertImageTruthList").parent().scroll(function(e){if($(this).scrollTop()+$(this).height()>=$("#insertImageTruthList").height()-34){listTruthImage(self)}});$("#insertImageMoreBtn a").click(function(e){listTruthImage(self)});initInputBoxClearButton(this);saveSelection(this);var imageUrl="";var imageInfo=getSelectedImageInfo(this);if(imageInfo!=null&&imageInfo.isImage&&imageInfo.video===""&&!imageInfo.emotion){imageUrl=decodeURI(imageInfo.url)}else{var selText=getSelectedText(this);if(selText.match(/^https?:\/\/(?:.*?)\.(?:jpg|jpeg|gif|png)(?:\?[^\?]*)?$/i)){imageUrl=selText}}this.dialog.title(this.title);switch(this.action){case ACTION_UPLOAD:$dialogContent.find(".tab-menu__item1, .tab-menu__item2, .tab-menu__item3").hide();$dialogContent.find(".tab-menu__item4").addClass("active");$("#select_block").hide();$("#upload_block").show();this.dialog.buttons([BUTTON_MANAGE_IMAGE,{text:"取消",click:function(){closeDialog(self)}}]);break;case ACTION_INSERT:$dialogContent.find(".tab-menu__item1").addClass("active");$dialogContent.find(".tab-menu__item4").hide();this.hideTabs.forEach(function(v){$dialogContent.find(".tab-menu__item"+v).hide();$dialogContent.find(".tab-menu").removeClass("tab-menu__3")});$("#select_block").hide();$("#upload_block").show();this.dialog.buttons([BUTTON_MANAGE_IMAGE,{text:"取消",click:function(){closeDialog(self)}},{text:this.title,type:Dialogify.BUTTON_PRIMARY,click:function(){var checked=$dialogContent.find(".tab-menu__3 li.active").index();switch(checked){case 0:finish(1,self,this.$buttonList[2].data("images"));break;case 2:finish(0,self);break;case 3:finish(1,self,$("#insertImageUrl").val());break;default:}},disabled:true}]);break;case ACTION_SELECT:$dialogContent.find(".tab-menu__item4").addClass("active");$dialogContent.find(".tab-menu__item1").hide();this.hideTabs.forEach(function(v){if(v==1){v=4}$dialogContent.find(".tab-menu__item"+v).hide();$dialogContent.find(".tab-menu").removeClass("tab-menu__3")});$("#select_block").show();$("#upload_block").hide();this.dialog.buttons([BUTTON_MANAGE_IMAGE,{text:"取消",click:function(){closeDialog(self)}},{text:"選擇圖片",type:Dialogify.BUTTON_PRIMARY,click:function(){var checked=$dialogContent.find(".tab-menu__3 li.active").index();switch(checked){case 1:finish(2,self,self.dropzoneSelect.getQueuedFiles());break;case 2:finish(0,self);break;case 3:finish(1,self,$("#insertImageUrl").val());break;default:}},disabled:true}]);$("#manage_home_image").hide();break;case ACTION_CROP_UPLOAD:$dialogContent.find(".tab-menu").hide();$dialogContent.find(".tab-menu__item4").addClass("active");$("#select_block").show().find(".pointer-none > h3").text("將一張圖片拖曳至此").next("a").text("或選擇一張圖片").next("p").text(this.options.cropDropzoneDesc||"");$("#upload_block").hide();this.dialog.buttons(['<label id="cropIgnore" class="post__text-small float-left"><input type="checkbox"> 不裁切圖片</label>',{id:"cropCancel",text:"取消",click:function(){closeDialog(self)}},{id:"cropPrevious",text:"上一步"},{id:"cropConfirm",text:"確定送出",type:Dialogify.BUTTON_PRIMARY}]);this.dialog.$buttonList["cropIgnore"].hide();this.dialog.$buttonList["cropPrevious"].hide();this.dialog.$buttonList["cropConfirm"].hide();break;default:throw"invalid action"}this.dialog.on("show",function(){initDropzone(self);initDropzoneSelect(self);if(self.action!=ACTION_CROP_UPLOAD){$.ajax({url:"https://api.gamer.com.tw/ajax/common/truth_image_quota.php",xhrFields:{withCredentials:true},dataType:"json"}).done(function(json){var used=json.total==0?0:new Number(json.used/json.total*100).toFixed(2);self.dialog.$content.find("#truthTotal").text(json.total/1024).end().find("#truthUsed").text(used).end().find("#truthSize").text(json.size)})}}).showModal();if(imageUrl!==""){self.dialog.$content.find(".tab-menu__3 .tab-menu__item3").click();$("#insertImageUrl").val(imageUrl).trigger("input")}};TruthImage.prototype.contentCallback=function(callback){this.options.contentCallback=callback};TruthImage.prototype.closeCallback=function(callback){this.options.closeCallback=callback};TruthImage.prototype.selectCallback=function(callback){this.options.selectCallback=callback};TruthImage.prototype.cropCallback=function(callback){this.options.cropCallback=callback};function initDropzone(truthImageInst){var images=[];var fileCount=0;var dropzone=new Dropzone("#dropzone",{url:"https://picc.gamer.com.tw/ajax/truth_image_upload.php",withCredentials:true,paramName:"dzfile",acceptedFiles:"image/gif,image/jpeg,image/png",resizeWidth:1920,resizeQuality:1,dictInvalidFileType:"上傳圖檔格式需為GIF, JPG, PNG",maxFiles:truthImageInst.selectModal==SELECT_SINGLE?1:null,transformFile:function(file,done){if((this.options.resizeWidth||this.options.resizeHeight)&&file.type!="image/gif"){this.resizeImage(file,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,function(resizedFile){done(resizedFile.size<file.size?resizedFile:file)})}else{done(file)}}});dropzone.on("sending",function(file,xhr,formData){$.ajax({url:"https://api.gamer.com.tw/ajax/common/truth_image_token.php",xhrFields:{withCredentials:true},dataType:"json",async:false}).done(function(json){if(json.token){formData.append("token",json.token)}})});dropzone.on("error",function(file,message){if(message=="Server responded with 0 code."){dropzone.emit("error",file,"系統忙碌中")}});dropzone.on("addedfile",function(file){fileCount++});dropzone.on("success",function(file,json){if(json.token!==undefined){$.ajax({url:"https://api.gamer.com.tw/ajax/common/truth_image_realupload.php?token="+json.token,xhrFields:{withCredentials:true},dataType:"json",async:false}).done(function(json){if(json.code!==undefined&&json.message){dropzone.emit("error",file,json.message)}else{fileCount--;Array.prototype.push.apply(images,json);listCache=[]}})}else{dropzone.emit("error",file,"上傳失敗")}});dropzone.on("queuecomplete",function(){if(images.length==0){return}if(fileCount==0){finish(1,truthImageInst,images)}else{truthImageInst.dialog.$content.find(".tab-menu__3 .tab-menu__item1").data("buttonEnabled",true);truthImageInst.dialog.$buttonList[2].data("images",images).enable()}});truthImageInst.dropzone=dropzone}function initDropzoneSelect(truthImageInst){var dropzone=new Dropzone("#dropzone_select",{url:"https://www.gamer.com.tw",maxFiles:1,acceptedFiles:"image/gif,image/jpeg,image/png",resizeWidth:1920,resizeQuality:1,dictInvalidFileType:"上傳圖檔格式需為GIF, JPG, PNG",transformFile:function(file,done){if(truthImageInst.action==ACTION_CROP_UPLOAD){initCropper(truthImageInst,file)}else{if((this.options.resizeWidth||this.options.resizeHeight)&&file.type!="image/gif"){this.resizeImage(file,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,function(resizedFile){finish(2,truthImageInst,[resizedFile.size<file.size?resizedFile:file])})}else{finish(2,truthImageInst,[file])}}}});truthImageInst.dropzoneSelect=dropzone}function appendTruthImage(truthImageInst,images){var list=$("#insertImageTruthList");var btn=$("#insertImageMoreBtn");var content="";for(let i=0;i<images.length;i++){var data=images[i];content+='<div class="uploadimage-home__item">';var style="";if(truthImageInst.selectModal==SELECT_SINGLE){style='style="display:none" '}content+='<div class="check-group">'+'<input id="check'+data.index+'" '+style+'type="checkbox" name="insertImageCheck" value="'+data.url+'">'+'<label for="check'+data.index+'" '+style+" >"+'<div class="label-icon"'+style+"></div>"+"</label>"+"</div>";content+='<div class="imgbox"><img src="'+data.thumb_url+'" /></div>'+"</div>"}if(images.length<16){btn.hide()}else{btn.show()}btn.before(content);if(images.length>0){return true}else{return false}}let listing=false;let listCache=[];function listTruthImage(truthImageInst,page){if(listing==true){return}var list=$("#insertImageTruthList");var btn=$("#insertImageMoreBtn");listing=true;page=list.data("page")||page;if(typeof listCache[page]!="undefined"){if(appendTruthImage(truthImageInst,listCache[page])){list.data("page",++page)}listing=false;return}$.ajax({url:"https://api.gamer.com.tw/ajax/common/truth_image_list.php",xhrFields:{withCredentials:true},data:{p:page},dataType:"json"}).done(function(response){if(response.code==0&&response.message=="ERR_NOLOGIN"){Dialogify.alert("請先登入");listing=false;return}else if(response.code==0&&response.message=="ERR_EMPTY"){btn.hide();listCache[page]=[];listing=false;return}listCache[page]=response;if(page==1){list.children(":not(#insertImageMoreBtn)").remove()}appendTruthImage(truthImageInst,response);list.data("page",++page);listing=false})}function finish(type,truthImageInst,urls){if(truthImageInst.action==ACTION_INSERT){switch(type){case 0:insertSelectedImage(truthImageInst);break;default:insertImage(truthImageInst,urls);break}}else if(truthImageInst.action==ACTION_SELECT){switch(type){case 0:selectFromSelectedImage(truthImageInst);break;case 2:var list=[];var reader=new FileReader;reader.addEventListener("load",function(){list.push(this.result);selectImage(truthImageInst,list,true)},false);reader.readAsDataURL(urls[0]);break;default:selectImage(truthImageInst,urls,false);break}}closeDialog(truthImageInst)}function closeDialog(truthImageInst){if(truthImageInst.dialog!=null&&truthImageInst.dialog!=undefined&&truthImageInst.dialog.isOpen()){truthImageInst.dialog.close()}if(truthImageInst.options!=null&&truthImageInst.options!=undefined&&truthImageInst.options.closeCallback!=null){truthImageInst.options.closeCallback.call(truthImageInst)}restoreSelection(truthImageInst)}function insertImage(truthImageInst,urls){if(typeof urls=="string"){urls=urls.replace(/\n$/,"");urls=urls.split(/\n/)}var text="";for(var i=0;i<urls.length;i++){if(urls[i]===""){continue}if(truthImageInst.options.contentCallback){text+=truthImageInst.options.contentCallback.call(truthImageInst,urls[i])}else{if(truthImageInst.plainText){text+=urls[i]}else{text+='<img src="'+urls[i]+'">'}}if(i<urls.length-1){if(truthImageInst.plainText){text+="\n"}else{text+="<br>"}}}if(text!==""){if(truthImageInst.plainText){insertText(truthImageInst,text)}else{insertHtml(truthImageInst,text)}}truthImageInst.options.onInsert&&truthImageInst.options.onInsert.call(truthImageInst)}function insertSelectedImage(truthImageInst){var rawUrls=[];var urls="";$('[name="insertImageCheck"]:checked').each(function(i,item){rawUrls.push([$(item).data("sort"),$(item).val()])});rawUrls.sort(sortImage);for(var key in rawUrls){urls+=rawUrls[key][1]+"\n"}if(urls===""){Dialogify.alert("請勾選要引用的圖片");return}insertImage(truthImageInst,urls)}function selectFromSelectedImage(truthImageInst){var rawUrls=[];var urls="";$('[name="insertImageCheck"]:checked').each(function(i,item){rawUrls.push([$(item).data("sort"),$(item).val()])});rawUrls.sort(sortImage);for(var key in rawUrls){urls+=rawUrls[key][1]+"\n"}if(urls===""){Dialogify.alert("請勾選要引用的圖片");return}selectImage(truthImageInst,urls,false)}function selectImage(truthImageInst,urls,isDataUrl){if(typeof urls=="string"){urls=urls.replace(/\n$/,"");urls=urls.split(/\n/)}truthImageInst.options.selectCallback.call(truthImageInst,urls,isDataUrl)}function sortImage(a,b){if(a[0]===b[0]){return 0}else{return a[0]<b[0]?-1:1}}function insertText(truthImageInst,text){if(!truthImageInst.plainText){return}truthImageInst.dialog.close();if(truthImageInst.options.closeCallback!=null){truthImageInst.options.closeCallback.call(truthImageInst)}restoreSelection(truthImageInst);var editor=truthImageInst.editor;var startPos=editor.prop("selectionStart");var start=editor.val().substring(0,startPos);var end=editor.val().substring(editor.prop("selectionEnd"));editor.val(start+text+end).focus();editor.prop("selectionStart",startPos);editor.prop("selectionEnd",startPos+text.length)}function insertHtml(truthImageInst,html){if(truthImageInst.plainText){return}truthImageInst.dialog.close();if(truthImageInst.options.closeCallback!=null){truthImageInst.options.closeCallback.call(truthImageInst)}restoreSelection(truthImageInst);if(truthImageInst.win==null){return}if(window.navigator.userAgent.match(/trident\/.*rv:([0-9]{1,}[.0-9]{0,})/i)){var selection,range;selection=truthImageInst.win.getSelection();if(selection&&selection.getRangeAt&&selection.rangeCount){range=selection.getRangeAt(0);range.deleteContents();var fragment=range.createContextualFragment(html);range.insertNode(fragment);range.collapse(false)}}else{truthImageInst.win.document.execCommand("inserthtml",false,html)}}function initInputBoxClearButton(truthImageInst){truthImageInst.dialog.$content.find(".input-box .clearall").click(function(e){$(this).removeClass("is-active").next("input").val("").trigger("input")});truthImageInst.dialog.$content.find(".input-box input").on("input",function(e){if(!$(this).val()){$(this).prev(".clearall").removeClass("is-active")}else{$(this).prev(".clearall").addClass("is-active")}})}function getSelectedImageInfo(truthImageInst){if(truthImageInst.plainText){return{isImage:false}}if(truthImageInst.win==null){return}var selection=truthImageInst.win.getSelection();if(!selection||selection.rangeCount==0){return{isImage:false}}var range=selection.getRangeAt(0);if(!range){return{isImage:false}}var container=range.startContainer;if(!container.tagName){return{isImage:false}}var node=container.childNodes[range.startOffset];if(!node||!node.nodeName.toLowerCase()=="img"){return{isImage:false}}var width=$(node).width()||0;var height=$(node).height()||0;var url=node.getAttribute("src")||"";var emotion=!!url.match(/^https?:\/\/i2\.bahamut\.com\.tw\/editor\/emotion\//);var video=node.getAttribute("data-movie")||"";if(!video&&url.match(/movie_pre.gif$/)){video=node.getAttribute("alt")||""}return{isImage:true,url:url,width:width,height:height,video:video,emotion:emotion}}function getSelectedText(truthImageInst){if(truthImageInst.plainText){if(truthImageInst.editor!=null){var startPos=truthImageInst.editor.prop("selectionStart");var endPos=truthImageInst.editor.prop("selectionEnd");return truthImageInst.editor.val().substring(startPos,endPos)}}else{if(truthImageInst.win!=null){var selection=truthImageInst.win.getSelection();if(!selection||selection.rangeCount==0){return""}var range=selection.getRangeAt(0);if(!range){return""}return range.toString()}}return""}function focusEditor(truthImageInst){if(truthImageInst.editor==null||truthImageInst.editor==undefined){return}if(truthImageInst.plainText){truthImageInst.editor.focus()}else{if(truthImageInst.win!=null){truthImageInst.win.focus();truthImageInst.editor.get(0).focus()}}}function saveSelection(truthImageInst){focusEditor(truthImageInst);if(truthImageInst.plainText){if(truthImageInst.editor!=null){savedSelection={selectionStart:truthImageInst.editor.prop("selectionStart"),selectionEnd:truthImageInst.editor.prop("selectionEnd")}}}else{if(truthImageInst.win!=null){var selection=truthImageInst.win.getSelection();if(!selection||selection.rangeCount==0){savedSelection=null}var range=selection.getRangeAt(0);if(!range){savedSelection=null}savedSelection={range:range}}}}function restoreSelection(truthImageInst){if(!savedSelection){return}focusEditor(truthImageInst);if(truthImageInst.plainText){if(truthImageInst.editor!=null){if(savedSelection.selectionStart&&savedSelection.selectionEnd){truthImageInst.editor.prop("selectionStart",savedSelection.selectionStart).prop("selectionEnd",savedSelection.selectionEnd)}}}else{if(savedSelection.range&&truthImageInst.win!=null){var selection=truthImageInst.win.getSelection();if(selection){selection.removeAllRanges();selection.addRange(savedSelection.range)}}}}function recountImageOrder(removedIndex){$('[name="insertImageCheck"]:checked').each(function(i,item){var itemId=$(item).attr("id");var labelNumber=$("label[for="+itemId+"] > div").text();if(labelNumber>removedIndex){$("label[for="+itemId+"] > div").text(--labelNumber)}})}function initCropper(truthImageInst,file){let reader=new FileReader;reader.onload=function(e){let oriDataUrl=e.target.result;let $dialogContent=truthImageInst.dialog.$content;let $buttonList=truthImageInst.dialog.$buttonList;$dialogContent.find(".tab-wrapper > div").hide();$("#crop_block").show();let options=truthImageInst.options.cropperOptions||{};options.preview=document.querySelector("#cropPreview > div");let cropImage=document.querySelector("#cropImage");cropImage.src=oriDataUrl;let cropper=new Cropper(cropImage,options);truthImageInst.cropper=cropper;$buttonList["cropCancel"].hide();$buttonList["cropPrevious"].off("click").on("click",()=>{truthImageInst.dropzoneSelect.removeAllFiles(true);cropper.destroy();$("#crop_block").hide();let currentTabIndex=$dialogContent.find("ul.tab-menu__3 > li.active").index();$dialogContent.find(".tab-wrapper > div").eq(currentTabIndex).show();$buttonList["cropPrevious"].hide();$buttonList["cropIgnore"].hide();$buttonList["cropConfirm"].hide();$buttonList["cropCancel"].show()}).show();$buttonList["cropIgnore"].show().find("input").off("change").on("change",function(){if(this.checked){cropper.clear();cropper.disable();$("#cropPreview img").css({width:"100%",height:"100%",objectFit:"contain",transform:""})}else{$("#cropPreview img").css({objectFit:""});cropper.enable();cropper.crop()}});$buttonList["cropConfirm"].off("click").on("click",()=>{let dataUrl;if($buttonList["cropIgnore"].find("input").prop("checked")){dataUrl=oriDataUrl}else{dataUrl=cropper.getCroppedCanvas().toDataURL(file.type,1)}truthImageInst.options.cropCallback.call(truthImageInst,dataUrl);closeDialog(truthImageInst)}).show()};reader.readAsDataURL(file)}var savedSelection;const BUTTON_MANAGE_IMAGE='<a id="manage_home_image" class="post__text-small float-left" href="https://home.gamer.com.tw/truthList.php" target="_blank">管理小屋圖片</a>';const TEMPLATE=`\n<div class="tab-wrapper">\n    <ul class="tab-menu text-center tab-menu__3">\n        <li class="tab-menu__item1"><a href="javascript:;">上傳</a></li>\n        <li class="tab-menu__item4"><a href="javascript:;">從電腦選擇圖片</a></li>\n        <li class="tab-menu__item2"><a href="javascript:;">小屋圖片</a></li>\n        <li class="tab-menu__item3"><a href="javascript:;">網址</a></li>\n        <hr>\n    </ul>\n    <div class="upload-files" style="display:none;" id="upload_block">\n        <div class="tab-content dialog__maxheight tab-box uploadimage dropzone" id="dropzone">\n            <div class="upload-files__body dz-message">\n                <img src="https://i2.bahamut.com.tw/forum/icons/pixel-preview.svg" class="pointer-none uploadimage_img">\n                <div class="pointer-none">\n                    <h3>將圖片拖曳到這裡</h3>\n                    <a href="javascript:;" class="btn">或選擇上傳圖片</a>\n                    <p>單張上限 <b id="truthSize"></b>K，超過上限圖片將會自動壓縮</p>\n                </div>\n            </div>\n        </div>\n        <p class="post__text-small text-center">\n            你已使用小屋圖片空間 <span id="truthTotal"></span>MB 中的 <span id="truthUsed"></span>%\n        </p>\n    </div>\n    <div class="upload-files" id="select_block">\n        <div class="tab-content dialog__maxheight tab-box uploadimage dropzone" id="dropzone_select">\n            <div class="upload-files__body dz-message">\n                <img src="https://i2.bahamut.com.tw/forum/icons/pixel-preview.svg" class="pointer-none uploadimage_img">\n                <div class="pointer-none">\n                    <h3>將圖片拖曳到這裡</h3>\n                    <a href="javascript:;" class="btn">或點擊選擇圖片</a>\n                    <p></p>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="tab-content dialog__maxheight tab-box uploadimage-home" style="display:none;">\n        <div id="insertImageTruthList" class="uploadimage-home__list uploadimage-home__list__maxheight">\n            <div id="insertImageMoreBtn" class="uploadimage-home__btnbg">\n                <a href="javascript:;" class="uploadimage-home__btn">顯示更多...</a>\n            </div>\n        </div>\n    </div>\n    <div class="tab-content dialog__maxheight tab-box uploadimage-url" style="display:none;">\n        <div class="input-box">\n            <a href="javascript:;" class="clearall"></a>\n            <input type="text" class="form-control" id="insertImageUrl" placeholder="輸入圖片網址">\n        </div>\n        <h5 class="post__text-small">因應網頁瀏覽安全，站上只支援 https 圖片連結。</h5>\n        <div class="imgbox">\n            <p class="post__text-small">此處將顯示圖片預覽</p>\n        </div>\n    </div>\n    <div id="crop_block" class="tab-content" style="display:none;">\n        <p>請拖曳或縮放想顯示的區塊</p>\n        <div>\n            <div>\n                <img id="cropImage">\n            </div>\n\n            <div id="cropPreview">\n                <div></div>\n                <small>預覽顯示</small>\n            </div>\n        </div>\n    </div>\n</div>\n    `;$(()=>{$("body").append($("<script>").attr({type:"text/template",id:"TruthImageTemplate"}).html(TEMPLATE))});window.Bahamut=window.Bahamut||{};window.Bahamut.TruthImage=TruthImage;window.Bahamut.TruthImage.ACTION_INSERT=ACTION_INSERT;window.Bahamut.TruthImage.ACTION_UPLOAD=ACTION_UPLOAD;window.Bahamut.TruthImage.ACTION_SELECT=ACTION_SELECT;window.Bahamut.TruthImage.ACTION_CROP_UPLOAD=ACTION_CROP_UPLOAD;window.Bahamut.TruthImage.SELECT_SINGLE=SELECT_SINGLE;window.Bahamut.TruthImage.SELECT_MULTIPLE=SELECT_MULTIPLE;window.Bahamut.TruthImage.TAB_UPLOAD=TAB_UPLOAD;window.Bahamut.TruthImage.TAB_SELECT=TAB_SELECT;window.Bahamut.TruthImage.TAB_INSERT=TAB_INSERT})(window,jQuery);