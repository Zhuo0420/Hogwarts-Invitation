(function($,window){var applePay={onApplePayLoaded:function(){if(window.ApplePaySession){var merchantIdentifier="merchant.tw.com.gamer.buy";if(ApplePaySession.canMakePayments()){$(".apple-btn").show();$(".apple-notice").hide();$(".apple-block").show()}else{$(".apple-btn").hide();$(".apple-block").hide();$(".apple-notice").show();console.log("請確認您的裝置，是否支援Apple Pay(1)")}}else{$(".apple-block").hide();$(".apple-btn").hide();$(".apple-notice").show();console.log("請確認您的裝置，是否支援Apple Pay(2)")}},onApplePaymentButtonClicked:function(service,servicesn,price){var paymentRequest={countryCode:"TW",currencyCode:"TWD",supportedNetworks:["visa","masterCard","jcb"],merchantCapabilities:["supports3DS"],total:{label:"巴哈商城",amount:price}};var session=new ApplePaySession(6,paymentRequest);session.onvalidatemerchant=function(event){$.ajax({url:"https://user.gamer.com.tw/cash/cash_spgateway_applepay_validation.php",method:"GET",crossDomain:true,xhrFields:{withCredentials:true},data:{u:event.validationURL}}).done(function(merchantSession){session.completeMerchantValidation(JSON.parse(merchantSession))})};session.onpaymentauthorized=function(event){$.ajax({url:"https://user.gamer.com.tw/cash/cash_spgateway_confirm.php",method:"POST",crossDomain:true,xhrFields:{withCredentials:true},data:{sn:servicesn,service:service,payway:"28",token:JSON.stringify(event.payment.token.paymentData)},dataType:"json",beforeSend:function(){new Dialogify("付款中，請勿重新整理頁面",{closable:false}).title("訊息").showModal()}}).done(function(e){if(e.data){session.completePayment(JSON.parse(ApplePaySession.STATUS_SUCCESS));location.href="https://buy.gamer.com.tw/checkout_order_done.php?vgshop=1"}else{session.completePayment(JSON.parse(ApplePaySession.STATUS_FAILURE));Dialogify.alert(e.error.message,{close:function(){location.href="https://buy.gamer.com.tw/vHistory.php?filter=1"}})}})};session.begin()}};window.applePay=applePay})(jQuery,window);