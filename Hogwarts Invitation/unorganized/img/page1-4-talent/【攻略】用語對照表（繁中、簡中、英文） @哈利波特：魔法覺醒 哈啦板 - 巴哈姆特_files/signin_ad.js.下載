(function(window,$,Util,undefined){var adUnit={video:"/1017768/AD_mobileweb_signin_videorewarded"};var adInited=false;var loadingDialog;var videoSlot;var finishAd=false;var loadingFlag=true;var loadingTimeoutTimer=0;var loadingTimeout=5e3;var csrf;var SigninAd={antiAdBlock:function(){$("body").append($("<div/>").addClass("afs_ads").html("ads"));var flag=true;var ad=$(".afs_ads").eq(0);if(ad===undefined||ad.text().length===0||ad.height()===0){Dialogify.alert("由於擋廣告插件會影響播放器運作，如果您有安裝，請您將 gamer.com.tw / bahamut.com.tw 網域加入白名單或考慮關閉插件，巴哈姆特感謝您的支持！");flag=false}$(".afs_ads").remove();return flag},initAd:function(){if(adInited===true){return false}var Bahamut=window.Bahamut||{};if(typeof Bahamut.Csrf!=="undefined"){csrf=new Bahamut.Csrf}googletag.pubads().enableAsyncRendering();googletag.enableServices();googletag.pubads().addEventListener("slotRenderEnded",function(e){if(e.slot===videoSlot){if(e.isEmpty){if(loadingDialog){loadingDialog.close()}SigninAd.loadingFail()}else{loadingTimeoutTimer=setTimeout(function(){if(loadingDialog){loadingDialog.close()}SigninAd.loadingFail();loadingFlag=false},loadingTimeout)}}});googletag.pubads().addEventListener("rewardedSlotReady",function(e){if(e.slot===videoSlot){if(loadingFlag===false){return false}clearTimeout(loadingTimeoutTimer);if(loadingDialog){loadingDialog.close()}Dialogify.confirm("是否觀看廣告？",{ok:function(){Dialogify.closeAll();window.onbeforeunload=function(){return"現在離開頁面將無法得到獎勵，是否確定離開頁面？"};e.makeRewardedVisible()}})}});googletag.pubads().addEventListener("rewardedSlotGranted",function(e){if(e.slot===videoSlot){window.onbeforeunload=null;SigninAd.setFinishAd()}});googletag.pubads().addEventListener("rewardedSlotClosed",function(e){if(e.slot===videoSlot){window.onbeforeunload=null;SigninAd.finishAd()}});adInited=true},startAd:function(){if(SigninAd.antiAdBlock()===false){return false}if(!User.Login.requireLogin()){return false}if(csrf===undefined){Dialogify.alert("發生錯誤，請稍後再嘗試(1)");return false}csrf.setCookie();$.ajax({url:"https://api.gamer.com.tw/mobile_app/bahamut/v1/sign_in_ad_start.php",method:"POST",headers:csrf.getJqueryHeaders(),dataType:"json",xhrFields:{withCredentials:true}}).done(function(res){if(res.error!==undefined){Util.errorHandler()(res.error);return false}var finished=parseInt(res.data.finished,10);if(finished===1){Dialogify.alert("您今天已經得到過雙倍巴幣獎勵囉！");var obj=$(".popup-dailybox__btn");if(obj.length!==0){obj.attr("disabled","");obj.text("領取雙倍巴幣");obj.removeAttr("onclick");finishAd=true}return false}finishAd=false;SigninAd.Player.videoByReward()}).fail(function(){Dialogify.alert("由於擋廣告插件會影響播放器運作，如果您有安裝，請您將 gamer.com.tw / bahamut.com.tw 網域加入白名單或考慮關閉插件，福利社感謝您的支持！")})},setFinishAd:function(){if(csrf===undefined){Dialogify.alert("發生錯誤，請稍後再嘗試(2)");return false}csrf.setCookie();$.ajax({url:"https://api.gamer.com.tw/mobile_app/bahamut/v1/sign_in_ad_finished.php",method:"POST",headers:csrf.getJqueryHeaders(),dataType:"json",xhrFields:{withCredentials:true}}).done(function(res){if(res.data!==undefined){if(parseInt(res.data.finished,10)===1){finishAd=true;window.Signin.finishAd()}}})},finishAd:function(){if(!User.Login.requireLogin()){return false}if(finishAd===false){setTimeout(window.SigninAd.finishAd,100);return false}finishAd=false;if(csrf===undefined){Dialogify.alert("發生錯誤，請稍後再嘗試(2)");return false}csrf.setCookie();$.ajax({url:"https://api.gamer.com.tw/mobile_app/bahamut/v1/sign_in_ad_finished.php",method:"POST",dataType:"json",headers:csrf.getJqueryHeaders(),xhrFields:{withCredentials:true}}).done(function(res){if(res.error!==undefined){Util.errorHandler()(res.error);return false}var finished=parseInt(res.data.finished,10);if(finished===1){Dialogify.alert("觀看廣告完成，獲得雙倍巴幣獎勵。")}else{Dialogify.alert("您今天已經得到過雙倍巴幣獎勵囉！")}var obj=$(".popup-dailybox__btn");if(obj.length!==0){obj.attr("disabled","");obj.text("領取雙倍巴幣");obj.removeAttr("onclick")}}).fail(function(){Dialogify.alert("由於擋廣告插件會影響播放器運作，如果您有安裝，請您將 gamer.com.tw / bahamut.com.tw 網域加入白名單或考慮關閉插件，福利社感謝您的支持！")})},loadingFail:function(){var url="https://www.gamer.com.tw/";url="https://bahamut.page.link/?link="+encodeURIComponent(url)+"&apn=tw.com.gamer.android.activecenter&ibi=tw.com.gamer.bahabook&isi=479826450";var html='<div class="dialogify__content--dlapp">';html+="<p>廣告能量補充中 <br>請稍後再試。</p>";html+='<div class="popup__qrcode"><small>若持續遇到此問題，建議改用巴哈姆特 APP 參與活動。</small><a id="qrcode" href="'+url+'" target="_blank"></a><p>開啟巴哈姆特 App</p></div>';html+="</div>";new Dialogify(html).buttons([{text:"關閉",type:Dialogify.BUTTON_DANGER,click:function(){this.close()}}]).showModal();$("#qrcode").qrcode({width:120,height:120,text:url})}};if(typeof window.googletag=="undefined"){window.googletag={cmd:[]}}window.googletag.cmd.push(SigninAd.initAd);var Player={videoByReward:function(){loadingDialog=new Dialogify('<div class="fuli-ads"><p class="fuli-ad__loading">廣告載入中</p></div>',{closable:false,dialog:{className:"dialogify__adsPopup"}});loadingDialog.showModal();googletag.destroySlots([videoSlot]);videoSlot=googletag.defineOutOfPageSlot(adUnit.video,googletag.enums.OutOfPageFormat.REWARDED).addService(googletag.pubads());googletag.display(videoSlot)}};window.SigninAd=SigninAd;window.SigninAd.Player=Player})(window,jQuery,Util);