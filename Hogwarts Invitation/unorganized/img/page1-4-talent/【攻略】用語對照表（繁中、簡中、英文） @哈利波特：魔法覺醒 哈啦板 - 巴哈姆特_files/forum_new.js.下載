var newVersion=0;function open_default(title,msg,btn){var content="";content+='<div class="open_win">';content+='<h1 class="open_wintitle"><img src="https://i2.bahamut.com.tw/h1_img.gif" />'+title+"</h1>";content+="<div>"+msg+"</div>";content+='<p class="open_winbtn">'+btn+"</p>";content+="</div>";egg.lightbox.open(content)}function share_show(event,snB){var soo=egg("#shareMenu_"+snB);if("block"==soo.css("display")){soo.css("display","none")}else{soo.css("display","block")}return false}function showShare(url,title){let content=jQuery('<div style="text-align: center;"></div>');let qrCode=jQuery('<div class="margin-bottom" style="margin-bottom: 16px"><a id="qrcode"></a></div>');let shareBtn=jQuery('<div style="display:inline-block" id="communityShare" class="community_sharebtn"></div>');content.append(qrCode);content.append(shareBtn);new Dialogify(content.prop("outerHTML")).title("分享").showModal();jQuery("#qrcode").qrcode({width:120,height:120,text:url});jQuery("#communityShare").append(communityShare(url,title))}function communityShare(url,title){let shareurl=encodeURIComponent(url);let shareItem=jQuery("<ul/>");shareItem.append(jQuery("<li/>").attr({"data-url":`https://wall.gamer.com.tw/share.php?url=${shareurl}`,"data-to":"wall"}).append(jQuery("<img/>").addClass("share-icon icon-baha").attr("src","https://i2.bahamut.com.tw/icon/share-icon_bh.svg"))).append(jQuery("<li/>").attr({"data-url":`https://www.facebook.com/sharer/sharer.php?u=${shareurl}`,"data-to":"fb"}).append(jQuery("<img/>").addClass("share-icon icon-fb").attr("src","https://i2.bahamut.com.tw/icon/share-icon_fb.svg"))).append(jQuery("<li/>").attr({"data-url":`https://social-plugins.line.me/lineit/share?url=${shareurl}`,"data-to":"line"}).append(jQuery("<img/>").addClass("share-icon icon-line").attr("src","https://i2.bahamut.com.tw/icon/share-icon_line.svg"))).append(jQuery("<li/>").attr({"data-url":`https://twitter.com/share?url=${shareurl}&text=${title}`,"data-to":"twitter"}).append(jQuery("<img/>").addClass("share-icon icon-twitter").attr("src","https://i2.bahamut.com.tw/icon/share-icon_twitter.svg"))).append(jQuery("<li/>").attr({"data-url":`http://www.plurk.com/?qualifier=shares&status=${shareurl}`,"data-to":"plurk"}).append(jQuery("<img/>").addClass("share-icon icon-plurk").attr("src","https://i2.bahamut.com.tw/icon/share-icon_plurk.svg"))).append(jQuery("<li/>").addClass("copyBtn").append(jQuery("<img/>").addClass("share-icon icon-link").attr("src","https://i2.bahamut.com.tw/icon/share-icon_link.svg")).append(jQuery("<input/>").attr({id:"copyUrl",type:"hidden"}).val(url)));jQuery("li:not(.copyBtn)",shareItem).click(function(){Share.share(jQuery(this).data("url"),jQuery(this).data("to"))});jQuery("li.copyBtn",shareItem).click(function(){Share.copy()});return shareItem}function forumShowAllMedia(o){if(!jQuery.cookie("BAHAID")&&"Y"==attachMediaLogin){Dialogify.confirm("您需要先登入才能觀看喔",{ok:function(){o.href="https://user.gamer.com.tw/login.php";return true},cancel:function(){o.href="javascript:void(0)"}});return false}var img=egg("[name=attachImgName]").get();if(img){var imgLength=img.length;for(i=0;i<imgLength;i++){attachIMG(img[i],"show")}}var movie=egg("[name=attachMovieName]").get();if(movie){var movieLength=movie.length;for(i=0;i<movieLength;i++){attachMOVIE(movie[i])}}return false}function confirmLink(link){var re=/^https?:\/\/[^\.]+.gamer.com.tw/;if(link.match(re)){window.open(link,"_blank","menubar=1,status=1,location=1,scrollbars=1,resizable=1")}else{Dialogify.confirm("您即將開啟下列連結，確定嗎?<br/><br/>"+link+"<br/><br/>(巴哈姆特提醒您，不明連結可能包含木馬程式)",{ok:function(){window.open(link,"_blank","menubar=1,status=1,location=1,scrollbars=1,resizable=1")}})}}function showCommend(bsn,snB,snC,user,nick,commend,time,type,order){if(""==nick){nick=user}if(commend){commend=commend.replace(/\[([a-zA-Z][a-zA-Z0-9]{1,11}):([^\]]*)\]/g,function(tag,userid,nickname){return'<a target="_blank" href="https://home.gamer.com.tw/'+userid+'">'+nickname+"</a>"})}var txt="";switch(type){case"nologin":txt='<p name="mcolorC_'+user.toLowerCase()+'" class="FM-cbox10A" id="Commendcontent_'+snC+'"><button type="button" onClick="location.href=\'https://user.gamer.com.tw/login.php\'">檢舉</button><a href="http://home.gamer.com.tw/'+user+'" title="'+user+'">'+nick+"</a>："+commend+"<span>"+time+"</span></p>";break;case"login":txt='<p name="mcolorC_'+user.toLowerCase()+'" class="FM-cbox10A" id="Commendcontent_'+snC+'"><button type="button" onclick="return showaccuseCommend(\''+bsn+"','"+snB+"','"+snC+'\')">檢舉</button><a href="http://home.gamer.com.tw/'+user+'" title="'+user+'">'+nick+"</a>："+commend+"<span>"+time+"</span></p>";break;case"me":txt='<p name="mcolorC_'+user.toLowerCase()+'" class="FM-cbox10A" id="Commendcontent_'+snC+'"><input id="delcbox_'+snC+'" type="checkbox" value="'+snC+'" /><button type="button" onclick="return showaccuseCommend(\''+bsn+"','"+snB+"','"+snC+'\')">檢舉</button><button type="button" onclick="return delCommend(\''+bsn+"','"+snB+"','"+snC+'\')">X</button><a href="http://home.gamer.com.tw/'+user+'" title="'+user+'">'+nick+"</a>："+commend+"<span>"+time+"</span></p>";break;case"me2":txt='<p name="mcolorC_'+user.toLowerCase()+'" class="FM-cbox10A" id="Commendcontent_'+snC+'"><button type="button" onclick="return showaccuseCommend(\''+bsn+"','"+snB+"','"+snC+'\')">檢舉</button><button type="button" onclick="return delCommend(\''+bsn+"','"+snB+"','"+snC+'\')">X</button><a href="http://home.gamer.com.tw/'+user+'" title="'+user+'">'+nick+"</a>："+commend+"<span>"+time+"</span></p>";break;case"del":txt='<p class="FM-cbox10A" id="Commendcontent_'+snC+'"><a href="http://home.gamer.com.tw/'+user+'" title="'+user+'">'+nick+"</a>："+commend+"<span>"+time+"</span></p>";break;case"old":txt='<p name="mcolorC_'+user.toLowerCase()+'" class="FM-cbox10A" id="Commendcontent_'+snC+'"><a href="http://home.gamer.com.tw/'+user+'" title="'+user+'">'+nick+"</a>："+commend+"<span>"+time+"</span></p>";break}if(order=="CHANGE"){oo=egg("#Commendcontent_"+snC).get()[0];txt='<a href="http://home.gamer.com.tw/'+user+'" title="'+user+'">'+nick+"</a>："+commend+"<span>"+time+"</span>";oo.innerHTML=txt}else if(order=="ALL"){return txt}else{oo=egg("#Commendlist_"+snB).get()[0];oo.innerHTML=txt+oo.innerHTML}}function moreCommend(bsn,snB,next_snC){method:"GET",jQuery.ajax({url:"/ajax/moreCommend.php",data:{bsn:bsn,snB:snB,next_snC:next_snC},method:"GET",dataType:"json"}).done(function(rdata){rdata_allCommend(rdata,"MORE")})}function allCommend(bsn,snB,where){egg("#"+where).css("display","none");egg("#close"+where).get()[0].style.display="";egg("#Commendlist5_"+snB).html(egg("#Commendlist_"+snB).html());jQuery.ajax({url:"/ajax/moreCommend.php",data:{bsn:bsn,snB:snB},method:"GET",dataType:"json"}).done(function(rdata){rdata_allCommend(rdata,"ALL")})}function rdata_allCommend(rdata,order){if(rdata["errMsg"]){open_default("&nbsp",rdata["errMsg"],'<input type="button" value="確定" onclick="egg.lightbox.close();" />')}else{var oo=egg("#Commendlist_"+rdata[0]["snB"]).get()[0];var content="";for(var key in rdata){content=showCommend(rdata[key]["bsn"],rdata[key]["snB"],rdata[key]["sn"],rdata[key]["userid"],rdata[key]["nick"],rdata[key]["comment"],rdata[key]["time"],rdata[key]["type"],"ALL")+content}var lbsn=rdata[0]["bsn"];var lsnB=rdata[0]["snB"];if("ALL"==order||"MORE"==order){var next_snC=rdata["next_snC"];if(next_snC=="0"){egg("#CommendMore_"+lsnB).html("");egg("#CommendMore_"+lsnB).css("display","none")}else{egg("#CommendMore_"+lsnB).html('<p class="FM-cbox10A"><a href="javascript:moreCommend('+lbsn+", "+lsnB+", "+next_snC+')" class="delay_open">檢視舊留言...</a></p>');egg("#CommendMore_"+lsnB).css("display","")}}if("ALL"==order){oo.innerHTML=content}else if("MORE"==order){oo.innerHTML=content+oo.innerHTML}else{oo.innerHTML=oo.innerHTML+content}if("60404"==rdata[0]["bsn"]){manager_changecolor_comment()}}}function closeallCommend(bsn,snB,where){egg("#"+where).get()[0].style.display="";egg("#close"+where).get()[0].style.display="none";egg("#Commendlist_"+snB).html(egg("#Commendlist5_"+snB).html());egg("#CommendMore_"+snB).html("")}function checkallCommend(snB,flag){oo=egg("#Commendlist_"+snB).get()[0];oo2=oo.getElementsByTagName("input");for(i=0;i<oo2.length;i++){if(oo2[i].type=="checkbox"){oo2[i].checked=flag}}}function delCommends(bsn,snB){oo=egg("#Commendlist_"+snB).get()[0];oo2=oo.getElementsByTagName("input");var del=new Array;var j=0;for(i=0;i<oo2.length;i++){if(oo2[i].type=="checkbox"&&oo2[i].checked==true){del[j]=oo2[i].value;j++}}delCommend(bsn,snB,del)}function delCommend(bsn,snB,del){if(!jQuery.cookie("BAHAID")){Dialogify.confirm("請先登入",{ok:function(){location.href="https://user.gamer.com.tw/login.php"},cancel:function(){location.href="javascript:void(0)"}});return false}if(""==del){Dialogify.alert("你必須要選擇你要刪除的推文");return false}jQuery.ajax({url:"/ajax/delCommend1.php",data:{bsn:bsn,snB:snB,del:del,returnHtml:newVersion},dataType:"json",method:"POST"}).done(rdata_del);return false}function waterCommends(bsn,sn){var userid="";var commentList=false;var url="https://forum.gamer.com.tw/Co.php?bsn="+bsn+"&sn="+sn;jQuery("#Commendlist_"+sn).find("input[type=checkbox]:checked").each(function(){var val=jQuery(this).val();userid+=","+jQuery("#comment_author_"+val).val()});userid=userid.substr(1);FORUM_water(bsn,userid,1,url,0)}function rdata_del(rdata){if(rdata["errMsg"]){egg.lightbox.close();open_default("&nbsp",rdata["errMsg"],'<input type="button" value="確定" onclick="egg.lightbox.close();" />')}else if(rdata["checkMsg"]){open_default("&nbsp",rdata["checkMsg"],rdata["checkBtn"])}else{for(var key in rdata){if(newVersion){var commentSelector="#Commendcontent_"+key;jQuery(commentSelector).replaceWith(rdata[key]);Forum.C.bindReplyMenuTippy(commentSelector);Forum.C.bindCommentGpBpListTippy(commentSelector);Forum.C.bindCommentDateTippy(commentSelector);Forum.C.commentFormatter(commentSelector+" .reply-content__article > span.comment_content");GamerCard.bind(commentSelector)}else{showCommend(rdata[key]["bsn"],rdata[key]["snB"],rdata[key]["sn"],rdata[key]["userid"],rdata[key]["nick"],rdata[key]["comment"],rdata[key]["time"],rdata[key]["type"],"CHANGE")}}}}function showaccuseCommend(bsn,snB,snC,hasMaster){let masterOption="";if(hasMaster==1){masterOption='<option value="1">與本板主題無關</option>'}let dialogHtml=`
        <div class="dialog-report">
            <p>這篇是</p>
            <select class="dropdown-group" name="subject" id="accuse_post_areason">
                <option value="0">-請選擇理由-</option>
                ${masterOption}
                <option value="2">洗板</option>
                <option value="3">謾罵</option>
                <option value="4">盜版</option>
                <option value="5">限制級</option>
                <option value="6">其他理由</option>
            </select>
        </div>
        <textarea type="text" class="form-control" placeholder="請輸入50字內之說明" id="accuse_post_Exp"></textarea>
        <p class="post__text-small">人身攻擊、侵犯個人隱私、著作權限當事人檢舉。<br>惡意檢舉，經查證屬實將依站規處分</p>
    `;let accuseDialog=new Dialogify(dialogHtml,{useDialogForm:false}).title("檢舉留言").buttons([`<a class="post__text-small float-left dialog-report_small"
            href="https://user.gamer.com.tw/help/detail.php?sn=395" target="_blank">
            <img src="https://i2.bahamut.com.tw/forum/icons/pixel-Q.svg">檢舉說明
        </a>`,{text:"取消",click:function(){this.close()}},{text:"送出",type:Dialogify.BUTTON_PRIMARY,click:function(){accuseCommend(bsn,snB,snC)}}],{position:Dialogify.BUTTON_RIGHT});accuseDialog.$buttonList[2].disable();jQuery("#accuse_post_Exp").hide();jQuery("#accuse_post_areason").change(function(){if(this.options[this.selectedIndex].value==6){jQuery("#accuse_post_Exp").show()}else{jQuery("#accuse_post_Exp").hide()}if(this.options[this.selectedIndex].value==0){accuseDialog.$buttonList[2].disable()}else{accuseDialog.$buttonList[2].enable()}});accuseDialog.showModal()}function accuseCommend(bsn,snB,snC){let accuseOption=jQuery("#accuse_post_areason").get()[0];let accuse_post_Value=accuseOption.options[accuseOption.selectedIndex].value;let accuse_post_Exp="";if(accuse_post_Value==6){accuse_post_Exp=jQuery("#accuse_post_Exp").get()[0].value}else{accuse_post_Exp=accuseOption.options[accuseOption.selectedIndex].text}if(accuse_post_Exp==""||accuse_post_Exp=="-請選擇理由-"||accuse_post_Exp.replace(/ |　/g,"")==""){Dialogify.alert("請提供檢舉理由");return false}if(accuse_post_Exp.length>50){Dialogify.alert("字數超過50");return false}Dialogify.confirm("確定送出檢舉？",{ok:function(){getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/accuse_commend.php",data:{bsn:bsn,snB:snB,sn:snC,aExp:accuse_post_Exp,token:token},method:"POST"}).done(rdata_accuseCommend)})}})}function rdata_accuseCommend(xmldoc){let nodes=xmldoc.getElementsByTagName("errMsg");if(nodes.length){msg=nodes[0].textContent}else{msg="系統忙碌，請稍候再試"}if(msg==="檢舉完成"){Dialogify.closeAll()}Dialogify.alert(msg)}function getAvatarPic(uid){uidlow=uid.toLowerCase();return"https://avatar2.bahamut.com.tw/avataruserpic/"+uidlow.substr(0,1)+"/"+uidlow.substr(1,1)+"/"+uidlow+"/"+uidlow+"_s.png"}function FORUM_homeBookmark(area,bsn,sn,atitle,dc1,dc2,dtype,dmachine,dname){if(!User.Login.requireLogin()){return false}let aurl;if(area=="G2"){aurl="http://forum.gamer.com.tw/G2.php?bsn="+bsn+"&sn="+sn}else{aurl="http://forum.gamer.com.tw/Co.php?bsn="+bsn+"&sn="+sn}let anopic="";if(jQuery(`#cf${sn} a[name=attachImgName]:first`).attr("id")){anopic=jQuery(`#cf${sn} a[name=attachImgName]:first`).attr("id");if(!anopic.match(/^https?:\/\/truth\.bahamut\.com\.tw\//)){anopic=""}}if(anopic==""){let nopic_tmp=jQuery("#avatar_fpath"+sn).attr("src");anopic=nopic_tmp.replace(/\?x=\d{10}$/g,"")}let csrf=new Bahamut.Csrf;csrf.setCookie();jQuery.ajax({url:"https://api.gamer.com.tw/home/v1/bookmark_new.php",method:"GET",data:{title:atitle,url:aurl,dcc1:dc1,dcc2:dc2,dctype:dtype,dcmachine:dmachine,gname:dname,nopic:anopic,_t:Date.now()},xhrFields:{withCredentials:true},headers:csrf.getJqueryHeaders()}).done(function(json){if(json.hasOwnProperty("error")){Dialogify.alert(json.error.message)}else{Dialogify.alert('收藏完成！已收至<a href="http://home.gamer.com.tw/bookmark.php?owner='+User.Login.getUserid()+'" target="_blank">「我的收藏」</a>。')}});return false}function addgpbp(elem,bsn,snB,t,evt){if(!forum_chkLogin()){return false}getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/newGPBP.php",data:{bsn:bsn,snB:snB,t:t,token:token},method:"POST",beforeSend:function(){jQuery(elem).attr("disabled","disabled").prop("disabled",true)},complete:function(){jQuery(elem).removeAttr("disabled").prop("disabled",false)}}).done(function(xmldoc){rdata_gpbp(xmldoc,"NEW")})});return false}var toastres={};function rdata_gpbp(xmldoc,actionkind){var nodes=xmldoc.getElementsByTagName("errMsg");if(nodes.length){toastr.warning(nodes[0].textContent,"",{tapToDismiss:true})}else if(xmldoc.getElementsByTagName("restore").length){var bsn=jQuery("bsn",xmldoc).text();var snB=jQuery("snB",xmldoc).text();delGPBP(bsn,snB)}else{var bsn=jQuery("bsn",xmldoc).text();var snB=jQuery("snB",xmldoc).text();var type=xmldoc.getElementsByTagName("type");var increment=xmldoc.getElementsByTagName("increment");if("1"==type[0].textContent){var oo="#gp_"+snB;var oo2="#upgp_"+snB;var over="爆";if("NEW"===actionkind){var toastrHtml='勇者獲得了 1 點能量<a href="javascript:delGPBP('+bsn+", "+snB+');" style="float:right;color:yellow;">復原</a>';toastres[bsn+"_"+snB]=toastr.success(toastrHtml,"",{timeOut:1e4});jQuery(oo).addClass("is-active");ga("send","event","互動","哈啦區","GP");if(parseInt(bsn,10)==60076){ga("send","event","互動","哈啦區","GP-場外")}}else{jQuery(oo).removeClass("is-active");toastr.info("您的動作已復原","",{tapToDismiss:true})}}else{var oo="#bp_"+snB;var oo2="#upbp_"+snB;var over="X";if("NEW"===actionkind){var toastrHtml='勇者削弱了 1 點精神<a href="javascript:delGPBP('+bsn+", "+snB+');" style="float:right;color:yellow;">復原</a>';toastres[bsn+"_"+snB]=toastr.success(toastrHtml,"",{timeOut:1e4});jQuery(oo).addClass("is-active");ga("send","event","互動","哈啦區","BP");if(parseInt(bsn,10)==60076){ga("send","event","互動","哈啦區","BP-場外")}}else{jQuery(oo).removeClass("is-active");toastr.info("您的動作已復原","",{tapToDismiss:true})}}if(newVersion){oo2num="-"==jQuery(oo).siblings(".count").html()?0:jQuery(oo).siblings(".count").html()}else{oo2num="-"==jQuery(oo).html()?0:jQuery(oo).html()}if(num>999||"爆"==oo2num||"X"==oo2num){var num=over}else{var num=parseInt(oo2num)+parseInt(increment[0].textContent)}if(0==num&&"1"!=type[0].textContent){num="-"}if(newVersion){jQuery(oo).siblings(".count").html(num)}else{jQuery(oo).html(num);jQuery(oo2).html(num)}}}function delGPBP(bsn,snB){toastr.clear(toastres[bsn+"_"+snB],{force:true});delete toastres[bsn+"_"+snB];getCSRFToken().done(function(token){jQuery.post("/ajax/delGPBP.php",{bsn:bsn,snB:snB,token:token},function(xmldoc){rdata_gpbp(xmldoc,"DEL")})})}function accuse_step1(bsn,sn,hasMaster,donateIsOpen){if(!egg.cookie.get("BAHAID")){Dialogify.confirm("您需要先登入才能使用此項功能喔",{ok:function(){location.href="https://user.gamer.com.tw/login.php"}});return false}jQuery.ajax({url:"/ajax/accuse_postdata.php",data:{bsn:bsn,sn:sn},success:function(txtdoc){accuse_step1r(txtdoc,bsn,sn,hasMaster,donateIsOpen)}});return false}function accuse_step1r(txtdoc,bsn,sn,hasMaster,donateIsOpen){if(parseInt(txtdoc,10)!=1){Dialogify.alert(txtdoc)}else{let masterOption="";if(hasMaster==1){masterOption='<option value="1">與本板主題無關</option>'}let donateOption="";if(donateIsOpen){donateOption='<option value="7">不合宜贊助文</option>'}let politic="";if(bsn==60076){politic='<option value="8">政治文</option>'}let dialogHtml=`
            <div class="dialog-report">
                <p>這篇是</p>
                <select class="dropdown-group" name="subject" id="accuse_post_areason">
                    <option value="0">-請選擇理由-</option>
                    ${masterOption}
                    <option value="2">洗板</option>
                    <option value="3">謾罵</option>
                    <option value="4">盜版</option>
                    <option value="5">限制級</option>
                    ${donateOption}
                    ${politic}
                    <option value="6">其他理由</option>
                </select>
            </div>
            <textarea type="text" class="form-control" placeholder="請輸入50字內之說明" id="accuse_post_Exp"></textarea>
            <p class="post__text-small">人身攻擊、侵犯個人隱私、著作權限當事人檢舉。<br>惡意檢舉，經查證屬實將依站規處分</p>
        `;let accuseDialog=new Dialogify(dialogHtml,{useDialogForm:false}).title("檢舉文章").buttons([`<a class="post__text-small float-left dialog-report_small"
              href="https://user.gamer.com.tw/help/detail.php?sn=395" target="_blank">
              <img src="https://i2.bahamut.com.tw/forum/icons/pixel-Q.svg">檢舉說明
          </a>`,{text:"取消",click:function(){this.close()}},{text:"送出",type:Dialogify.BUTTON_PRIMARY,click:function(){accuse_step2(bsn,sn,this)}}],{position:Dialogify.BUTTON_RIGHT});accuseDialog.$buttonList[2].disable();jQuery("#accuse_post_Exp").hide();jQuery("#accuse_post_areason").change(function(){let optValue=this.options[this.selectedIndex].value;if(optValue==6||optValue==7){jQuery("#accuse_post_Exp").show();jQuery("#accuse_post_Exp").attr("placeholder",`請輸入${optValue==7?"200":"50"}字內之說明`)}else{jQuery("#accuse_post_Exp").hide()}if(optValue==0){accuseDialog.$buttonList[2].disable()}else{accuseDialog.$buttonList[2].enable()}});accuseDialog.showModal()}}function accuse_step2(bsn,sn,accuseDialog){let accuseOption=jQuery("#accuse_post_areason").get()[0];let accuse_post_Value=accuseOption.options[accuseOption.selectedIndex].value;let accuse_post_Exp="";if(accuse_post_Value==6||accuse_post_Value==7){accuse_post_Exp=jQuery("#accuse_post_Exp").get()[0].value}else{accuse_post_Exp=accuseOption.options[accuseOption.selectedIndex].text}if(accuse_post_Exp==""||accuse_post_Exp=="-請選擇理由-"||accuse_post_Exp.replace(/ |　/g,"")==""){Dialogify.alert("請提供檢舉理由");return false}reasonLenLimit=accuse_post_Value==7?200:50;if(accuse_post_Exp.length>reasonLenLimit){Dialogify.alert(`字數超過${reasonLenLimit}`);return false}Dialogify.confirm("確定送出檢舉？",{ok:function(){getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/accuse_postdata2.php",data:{bsn:bsn,sn:sn,aValue:accuse_post_Value,aExp:accuse_post_Exp,token:token},method:"POST"}).done(txtdoc=>accuse_step2r(txtdoc,accuse_post_Value))})}});accuseDialog.close()}function accuse_step2r(txtdoc,accuse_post_Value){switch(txtdoc){case"ERROR_LOGIN":ba_checkLogin("no");break;case"ERROR_DATA":Dialogify.alert("資料查詢失敗，請重新操作。");egg.lightbox.close();break;case"ERROR_EXPn":reasonLenLimit=accuse_post_Value==7?200:50;Dialogify.alert(`請提供檢舉理由，限${reasonLenLimit}字以內。`);break;case"ERROR_PERM":Dialogify.alert("權限不足。");break;case"ERROR_SYSTEM1":Dialogify.alert("資料查詢失敗(1-1)");break;case"ERROR_SYSTEM2":Dialogify.alert("無法檢舉本篇文章");break;case"ERROR_SYSTEM3":Dialogify.alert("資料查詢失敗(1-2)");break;case"ERROR_POSTED":Dialogify.alert("已舉報過。");break;case"ERROR_SYSTEM4":Dialogify.alert("資料查詢失敗(1-3)！");break;case"ERROR_SYSTEM5":Dialogify.alert("檢舉失敗，請重新操作。");egg.lightbox.close();break;case"ERROR_DEL":Dialogify.alert("您無法檢舉自己的文章，請自行編輯或刪除。");egg.lightbox.close();break;case"ERROR_TIMEOUT":Dialogify.alert("頁面逾時，請重新操作。");egg.lightbox.close();break;case"ERROR_60076":Dialogify.alert("註冊滿三個月才能使用此功能。");egg.lightbox.close();break;case"FINISH":if(accuse_post_Value==7){Dialogify.alert("檢舉已成功送出，站務人員將會再評估處理。")}else{Dialogify.alert("檢舉已成功送出，板務群將依規定評估處理。")}egg.lightbox.close();break}}function manager_changecolor(){if("undefined"==typeof manager){return false}for(i=0;i<manager.length;i++){egg("[name=mcolorTop_"+manager[i].toLowerCase()+"]").css("background-position","0 -666px");egg("[name=mcolorInfo_"+manager[i].toLowerCase()+"]").css({"background-image":"url(https://i2.bahamut.com.tw/forum/FM-cbg1a.gif)","background-position":"0 31px"})}}var manager_changecolor_comment=function(){if("undefined"==typeof manager){return false}for(i=0;i<manager.length;i++){jQuery("[name=mcolorC_"+manager[i].toLowerCase()+"]").addClass("FM-cbox10A bmt")}};function resizeImg(obj,w,h){w=w>645?645:w;if(w>0){jQuery(obj).attr("width",w)}if(h>0){jQuery(obj).attr("height",h)}}function attachIMG(o,event){if(!getCookie("BAHAID")&&"Y"==attachMediaLogin){Dialogify.confirm("您需要先登入才能觀看喔",{ok:function(){o.href="https://user.gamer.com.tw/login.php"}});return false}var imgid="IMG"+o.id;if(""==o.type){var newHTML='<img class="lazyload" data-sizes="auto" data-src="'+o.id+'" border=0>'}else{var ww=o.type.match(/width=[0-9]+/i);var hh=o.type.match(/height=[0-9]+/i);var width=ww?ww[0].match(/[0-9]+/)[0]:0;var height=hh?hh[0].match(/[0-9]+/)[0]:0;var newHTML='<img class="lazyload" data-sizes="auto" data-src="'+o.id+'" border=0 onload="resizeImg(this, '+width+","+height+')">'}if("click"==event){if(!o.getAttribute("data-expanded")){o.setAttribute("data-expanded","true");o.innerHTML=newHTML}else if(o.id!=o.href){confirmLink(o.href)}else{window.open(o.href,"","")}}else if("show"==event){if(!o.getAttribute("data-expanded")){o.setAttribute("data-expanded","true");o.innerHTML=newHTML}}return false}function attachMOVIE(o){if("javascript:void(0)"==o.href){return false}var osrc=o.href;if(!jQuery.cookie("BAHAID")&&"Y"==attachMediaLogin){Dialogify.confirm("您需要先登入才能觀看喔",{ok:function(){o.href="https://user.gamer.com.tw/login.php"}});return false}var width=560,height=315;if(o.href.match(/^https?:\/\/mymedia\.yam\.com\/\*\/[0-9]+$/)){width=560;height=150}if(osrc==o.href){osrc=osrc.replace(/https?:\/\/www.youtube.com\/v\//,"https://www.youtube.com/embed/");embedid="embed"+osrc+o.id;var newtube_pattern=/^https?:\/\/www\.youtube\.com\/embed\/([0-9a-zA-Z_-]{11})((?:(?:\&|\?|#|\&#)\w+=\w+)*)/,xuite_pattern=/^https?:\/\/vlog\.xuite\.net\/embed\/([a-zA-Z0-9]{24})((?:(?:\&|\?|#|\&#)\w+=[\w\.]+)*)/,nico_pattern=/^https?:\/\/ext\.nicovideo\.jp\/thumb_watch\/((?:sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz)[0-9]{1,14}|[0-9]{10})\?thumb_mode=html$/,twitch_justin_pattern=/^https?:\/\/(www|player)\.(twitch|justin)\.tv\/.*$/,livehouse_pattern=/^https:\/\/livehouse\.in\/embed\/channel\/(\w+)\/video$/,facebook_pattern=/^https?:\/\/www\.facebook\.com\/(\d+)\/videos\/(\w+)\/$/;var matches;if(osrc.match(newtube_pattern)){newHTML=new Util.EmbedPlayer.Youtube(osrc)}else if(osrc.match(xuite_pattern)){newHTML=new Util.EmbedPlayer.Xuite(osrc)}else if(osrc.match(nico_pattern)){newHTML=new Util.EmbedPlayer.Niconico(osrc)}else if(osrc.match(livehouse_pattern)){newHTML=new Util.EmbedPlayer.Livehouse(osrc)}else if(matches=osrc.match(twitch_justin_pattern)){newHTML=new Util.EmbedPlayer.Twitch(osrc)}else if(osrc.match(facebook_pattern)){newHTML=new Util.EmbedPlayer.Facebook(osrc)}newHTML.width=width;newHTML.height=height;o.innerHTML=newHTML;o.href="javascript:void(0)"}return false}function showMediaClick(t){if("img"==t){document.write("請點選觀看圖片")}else if("movie"==t){document.write("請點選觀看影片")}}function all_showEmotion_new(button,text){if(""!=egg("#emotionlist").get()){egg("#emotionlist").removeFrom(document.body);return}var div=document.createElement("div");egg(div).attr("id","emotionlist");egg(div).hide();egg(div).appendTo(document.body);var emontionlayoutlist="";for(i=1;i<=11;i++){emontionlayoutlist+='<a href="javascript:void(0)" onclick="all_addEmotion('+i+",'"+text+'\')"><img src="https://i2.bahamut.com.tw/editor/emotion/'+i+'.gif" /></a>'}emontionlayoutlist+="<br>";for(i=12;i<=23;i++){emontionlayoutlist+='<a href="javascript:void(0)" onclick="all_addEmotion('+i+",'"+text+'\')"><img src="https://i2.bahamut.com.tw/editor/emotion/'+i+'.gif" /></a>'}emontionlayoutlist+="<br>";for(i=24;i<=33;i++){emontionlayoutlist+='<a href="javascript:void(0)" onclick="all_addEmotion('+i+",'"+text+'\')"><img src="https://i2.bahamut.com.tw/editor/emotion/'+i+'.gif" /></a>'}emontionlayoutlist+="<br>";for(i=34;i<=43;i++){emontionlayoutlist+='<a href="javascript:void(0)" onclick="all_addEmotion('+i+",'"+text+'\')"><img src="https://i2.bahamut.com.tw/editor/emotion/'+i+'.gif" /></a>'}egg("#emotionlist").html(emontionlayoutlist);var pos=egg("#"+button).pos();egg("#emotionlist").css("left",pos.x+"px");egg("#emotionlist").css("top",pos.y+20+"px");egg("#emotionlist").show()}function all_addEmotion(esn,sn){egg("#emotionlist").removeFrom(document.body);var str="[em="+esn+"]";var textBox=egg("#"+sn).get()[0];if(newVersion){textBox.focus();if(window.getSelection){sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0);range.deleteContents();range.insertNode(document.createTextNode(str))}}else if(document.selection&&document.selection.createRange){document.selection.createRange().text=str}}else{if("提醒您：網路匿名發言仍需負相關法律責任，注意勿發表毀謗等違法文章。"==textBox.value){textBox.value=""}if(document.selection){textBox.focus();document.selection.createRange().text+=str}else{var pre=textBox.value.substr(0,textBox.selectionStart);var post=textBox.value.substr(textBox.selectionEnd);textBox.value=pre+str+post;textBox.focus()}}}function forum_chkLogin(){if(""==egg.cookie.get("BAHAID")||"guest"==egg.cookie.get("BAHAID")){egg.mutbox("請先登入才能進行此動作","訊息",{"確定":function(){location.href="https://user.gamer.com.tw/login.php"}});return false}return true}function forum_alert(msg,title,callback){if(msg===null||msg===void 0){msg=""}if(title===null||title===void 0){title="訊息"}if(!callback||typeof callback!=="function"){callback=function(){}}egg.mutbox(msg,title,{"關閉":function(){egg.lightbox.close();callback()}},{closeButton:false})}function getreport(bsn,btitle){var content='<table style="width:100%; border:3px solid #e5e5e5;">';content+="  <tr>";content+='    <td style="padding:3px 5px; border:1px solid #e5e5e5;text-align:center; background-color:#f6f6f6;">帳號</td>';content+='    <td style="padding:3px 5px; border:1px solid #e5e5e5;"><a style="color:#3e81c6;" href="http://home.gamer.com.tw/'+egg.cookie.get("BAHAID")+'">'+egg.cookie.get("BAHAID")+"</a></td>";content+="  </tr>";content+="  <tr>";content+='    <td style="padding:3px 5px; border:1px solid #e5e5e5;text-align:center; background-color:#f6f6f6;">看板</td>';content+='    <td style="padding:3px 5px; border:1px solid #e5e5e5;">'+btitle+"</td>";content+="  </tr>";content+="</table>";content+="";content+='<p style="color:#FF0000; font-size:13px; font-weight:bold; padding:10px 0;">請點擊「我要報到」並確認「下述事項」即可完成報到手續。</p>';content+="";content+='<table style="font-size:13px;">';content+="  <tr>";content+='    <td style="padding:5px 3px; line-height:18px; vertical-align:top;"><input name="check[]" type="checkbox" /></td>';content+='    <td style="padding:5px 3px; line-height:18px; vertical-align:top;">請經常造訪以下哈啦板：<a style="margin:0 5px;color:#3e81c6;" href="http://forum.gamer.com.tw/A.php?bsn=60140" target="_blank">現任板主群交流區(BM2)</a><a style="margin:0 5px;color:#3e81c6;" href="http://forum.gamer.com.tw/A.php?bsn=60248" target="_blank">哈啦區板務群-搏感情專用地</a><a style="margin:0 5px;color:#3e81c6;" href="http://forum.gamer.com.tw/A.php?bsn=60404" target="_blank">站務中心</a></td>';content+="  </tr>";content+="  <tr>";content+='    <td style="padding:5px 3px; line-height:18px; vertical-align:top;"><input name="check[]" type="checkbox" /></td>';content+='    <td style="padding:5px 3px; line-height:18px; vertical-align:top;">已詳讀<a style="margin:0 5px;color:#3e81c6;" href="http://forum.gamer.com.tw/G1.php?bsn=60140" target="_blank">現任板主群交流區(BM2) 精華區</a>與<a style="margin:0 5px;color:#3e81c6;" href="http://user.gamer.com.tw/help/rule.php" target="_blank">巴哈姆特站規</a></td>';content+="  </tr>";content+="  <tr>";content+='    <td style="padding:5px 3px; line-height:18px; vertical-align:top;"><input name="check[]" type="checkbox" /></td>';content+='    <td style="padding:5px 3px; line-height:18px; vertical-align:top;">依站規規定，連續 10 天未進入管理之看板以及當年度收到 10 封缺勤提醒通知信，予以免職。<a style="margin:0 5px;color:#3e81c6;" href="https://forum.gamer.com.tw/Co.php?bsn=60140&sn=125607" target="_blank">規定說明</a><br />';content+='      為免因上述原因遭卸任處分，請善用<a style="margin:0 5px;color:#3e81c6;" href="http://forum.gamer.com.tw/gemadmin/excuselist.php">請假系統</a>。</td>';content+="  </tr>";content+="</table>";egg.mutbox(content,"板主報到",{"我要報到":function(){report(bsn)},"取消":function(){egg.lightbox.close()}},{closeButton:false});egg.mutbox.option("width","450px");egg.mutbox.option({css:{"text-align":"left"}})}function report(bsn){if(3>egg(":checkbox[name=check[]]:checked").size()){Dialogify.alert("請確認所有注意事項");return}egg.lightbox.close();jQuery.ajax({url:"/ajax/bmreport.php",method:"POST",data:{bsn:bsn},cache:false,success:function(txt){var conf={buttons:egg.msgbox.OK,onOk:function(event){egg.msgbox.close()},onHide:function(){location.reload()}};egg.msgbox.setConfigure(conf);egg.msgbox(txt)}})}function applysubbm(bsn){new Dialogify("/ajax/apply_subbm_html.php?bsn="+bsn,{size:Dialogify.SIZE_LARGE,closable:false,useDialogForm:false}).title("申請副板").showModal()}function applysubbma(bsn){if(""==egg("#subbm").val()){Dialogify.alert("請填帳號");return}if(""==egg("#subbm_reason").val()){Dialogify.alert("請填原因");return}Dialogify.confirm("確認送出嗎？",{ok:function(){getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/applysubbm.php",data:{bsn:bsn,u:jQuery("#subbm").val(),r:jQuery("#subbm_reason").val(),token:token},method:"POST",cache:false}).done(function(txt){Dialogify.alert(txt)})})}})}function applydown(bsn){new Dialogify("/ajax/apply_down_html.php?bsn="+bsn,{size:Dialogify.SIZE_LARGE,closable:false,useDialogForm:false}).title("申請卸任").showModal()}function applydowna(bsn){var who=jQuery(":input[name=who]:checked").val();if(1==who){if(""==jQuery("#reason").val()){Dialogify.alert("請填原因");return}var userid=egg(":input[name=psubmaster]").val()}else{if(""==egg(":input[name=dsubmaster]").val()){Dialogify.alert("請選帳號");return}if(""==egg("#reason").val()){Dialogify.alert("請填原因");return}var userid=egg(":input[name=dsubmaster]").val()}var extraGM=jQuery('input[name="extra-gm"]:checked').val();Dialogify.confirm("確認送出嗎？",{ok:function(){getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/applydown.php",method:"POST",data:{bsn:bsn,w:who,u:userid,r:jQuery("#reason").val(),extraGM:extraGM,token:token},cache:false}).done(function(txt){Dialogify.alert(txt)})})}})}function FORUM_follow(bsn,snA,title){egg.lightbox.close();getCSRFToken().done(function(token){jQuery.ajax({url:"/ajax/forumFollow.php",method:"POST",data:{bsn:bsn,snA:snA,title:title,token:token},cache:false}).done(function(txt){Dialogify.alert(txt)})})}function waterShowChangeDate(start,select){var days=jQuery(select).val();if(days==0){jQuery("#water_change_date").hide();return}var startDate=new Date(start);var endDate=new Date(startDate.getTime()+days*24*60*60*1e3);var endDateStr=endDate.toJSON().slice(0,10);jQuery("#water_change_date").show();jQuery("#water_change_date").find("td:nth-child(2) p").html(start+"~"+endDateStr)}function waterToAbuse(userid,boardMaster){var linkUrl=encodeURIComponent(jQuery("#water_accuse_link").val().trim());var type=boardMaster==""?2:1;var url="https://user.gamer.com.tw/help/bbuse2.php?parm=1&area=2&type="+type+"&userid="+userid+"&link="+linkUrl;window.open(url,"_blank")}function FORUM_water(bsn,userid,type,linkurl,sn){sn=sn||0;if(userid.length===0){jQuery(':checkbox[name="jsn[]"]:checked').each(function(){userid+=","+jQuery("[name=author_"+this.value+"]").val()});userid=userid.substr(1)}if(userid.length===0){Dialogify.alert("請勾選你要水桶的名單，水桶為單板最重處分，請謹慎使用");return}jQuery.ajax({url:"/ajax/checkwater.php",success:function(jsontxt){data=JSON.parse(jsontxt);if(data.error!==undefined){Dialogify.alert(data.error)}else{if(data.notchange!==undefined){content="帳號："+data.userid+"<br>";content+="期限："+data.stime+"~"+data.etime+' <span style="color:red">'+data.abtitle+"</span><br>";content+="連結："+data.linkurl+"<br>";content+="原因：<br>";content+=data.reason;new Dialogify(content).title("水桶紀錄").showModal()}else{linkurl=linkurl||data.linkurl||"";content='<table style="width: 100%">';content+="<tr><td>帳號：</td><td>"+data.userid+"</td></tr>";if(data.type==3){content+='<tr><td>初犯期限：</td><td><select name="length1">';for(i=1;i<=data.mdays[0];i++){content+="<option value="+i+">"+i+"</option>"}content+="</select>日</td></tr>";content+='<tr><td>再犯期限：</td><td><select name="length2">';for(i=1;i<=data.mdays[1];i++){content+="<option value="+i+">"+i+"</option>"}content+="</select>日</td></tr>";content+='<tr><td>累犯期限：</td><td><select name="length3">';for(i=1;i<=data.mdays[2];i++){content+="<option value="+i+">"+i+"</option>"}content+="</select>日</td></tr>"}else{content+=`<tr><td>期限：</td><td><select name="length" onchange="waterShowChangeDate('`+data.stime+`', this);">`;if(type==2){content+="<option value=0>不修改</option>"}for(i=1;i<=data.days;i++){content+="<option value="+i+">"+i+"</option>"}content+="</select>日（原期限： "+data.stime+"~"+data.etime+' ）<span style="color:red">'+data.abtitle+"</span></td></tr>"}content+=`<tr id="water_change_date" style="display:none;"><td><p style="margin-top:10px;">修改後：</p></td><td><p style="margin-top:10px;"></p></td></tr>`;content+='<tr><td>連結：</td><td><input type="text" id="water_accuse_link" name="linkurl" value="'+linkurl+'" class="text-field dialogify-prompt-input"></td></tr>';content+=`<tr><td>原因：</td><td>（如發現重大違規可以在水桶後，<a onclick="waterToAbuse('`+data.userid+`','`+data.boardmaster+`');" href="javascript:void(0);">回報給A車</a> 處理。）</td></tr>`;content+='<tr><td colspan="2"><textarea name="reason" class="text-field">'+data.reason+"</textarea></td></tr>";if(type==2){boxtitle="編輯水桶名單"}else{boxtitle="新增水桶名單"}new Dialogify(content,{closable:false}).title(boxtitle).buttons([{type:Dialogify.BUTTON_PRIMARY,text:"送出",click:function(){var dialogify=this;getCSRFToken().done(function(token){this.disabled=true;if(data.type==3){var postData={bsn:bsn,type:data.type,length1:dialogify.$content.find("[name=length1]").val(),length2:dialogify.$content.find("[name=length2]").val(),length3:dialogify.$content.find("[name=length3]").val(),reason:dialogify.$content.find("[name=reason]").val(),id:data.userid,linkurl:dialogify.$content.find("[name=linkurl]").val(),sn:sn,token:token}}else{var postData={bsn:bsn,type:data.type,length:dialogify.$content.find("[name=length]").val(),reason:dialogify.$content.find("[name=reason]").val(),id:data.userid,linkurl:dialogify.$content.find("[name=linkurl]").val(),sn:sn,token:token}}jQuery.ajax({url:"/ajax/watera.php",data:postData,method:"POST"}).done(function(txt){Dialogify.alert(txt)})})}},{text:"取消",click:function(){this.close()}}],{position:Dialogify.BUTTON_CENTER}).showModal()}}},data:{bsn:bsn,type:type,uid:userid,sn:sn},method:"POST"})}function getCSRFToken(){return jQuery.ajax({url:"/ajax/getCSRFToken.php",cache:false})}var commentNew5=[];function extendComment(bsn,snB,doneCallback){jQuery("#showoldCommend_"+snB).hide();jQuery("#closeCommend_"+snB).show();commentNew5[snB]=jQuery("#Commendlist_"+snB).html();commentNew5[snB]=commentNew5[snB].replace(/ data-tooltipped=""/g,"").replace(/data-original-title=/g,"title=");var next_snC=jQuery("#moreCommentBtn_"+snB).attr("next");jQuery.ajax({url:"/ajax/moreCommend.php",data:{bsn:bsn,snB:snB,returnHtml:1,next_snC:next_snC},method:"GET",dataType:"json"}).done(function(rdata){var listSelector="#Commendlist_"+snB;jQuery(listSelector).empty().prepend(rdata["html"]);Forum.C.commentFormatter(listSelector+" .reply-content__article > span.comment_content");Forum.C.bindReplyMenuTippy(listSelector);Forum.C.bindCommentGpBpListTippy(listSelector);Forum.C.bindCommentDateTippy(listSelector);GamerCard.bind(listSelector);if(rdata["next_snC"]){jQuery("#moreCommentBtn_"+snB).attr("next",rdata["next_snC"]).show()}else{jQuery("#moreCommentBtn_"+snB).attr("next",0).hide()}if(doneCallback){doneCallback()}})}function foldedComment(snB){var listSelector="#Commendlist_"+snB;jQuery(listSelector).empty().append(commentNew5[snB]);jQuery("#showoldCommend_"+snB).show();jQuery("#closeCommend_"+snB).hide();Forum.C.bindReplyMenuTippy(listSelector);Forum.C.bindCommentGpBpListTippy(listSelector);Forum.C.bindCommentDateTippy(listSelector);GamerCard.bind(listSelector)}function showHonorDialog(userid,honorType){fetch(`https://api.gamer.com.tw/avatar/v1/switchhonor.php?userid=${userid}&honorType=${honorType}`,{credentials:"include"}).then(resp=>{resp.json().then(json=>{if(json.error){Dialogify.alert(json.error.message);return}let liHTML="";const forumDomain="forum.gamer.com.tw";json.data.forEach(board=>{liHTML+=`<li><a href="https://${forumDomain}/A.php?bsn=${board.bsn}" target="_blank">${board.title}</a></li>`});let title=honorType==3?"板主":"副板";new Dialogify(`
                <p>${userid} 任職${title}如下</p>
                <div class="box-bg_gray dialogify_board-list">
                    <ul>${liHTML}</ul>
                </div>
            `).title("任職看板").showModal()})}).catch(reason=>{console.error(reason)})}