(function($,window,undefined){"use strict";var GamerCard=function(){};const config=window.GamerCardConfig||{};const INIT_DOM_READY=config.init===undefined?true:config.init;const SELECTOR=config.selector||".gamercard";const DATA_KEY_USERID=config.dataKeyUserid||"gamercard-userid";const TEMPLATE_ID="gamerCardTemplate";var USER_DATA={};GamerCard.prototype.bind=function(parentSelector){if($("#"+TEMPLATE_ID).length==0){var contentDiv=$("<div />").addClass("usercard").html(HTML_PROGRESS);$("<div />").attr("id",TEMPLATE_ID).hide().append(contentDiv).appendTo("body")}var currentUserid;var prevPopper;let prevInstance=null;var tippySelector=SELECTOR+":not([data-tooltipped]):not([aria-expanded])";if(parentSelector){tippySelector=parentSelector+" "+tippySelector}if(tippy.delegate){const tip=tippy.delegate("body",{target:tippySelector,allowHTML:true,content:window.document.getElementById(TEMPLATE_ID).innerHTML,appendTo:window.document.body,arrow:true,placement:"top-start",maxWidth:"none",delay:[600,300],theme:"light",interactive:true,interactiveBorder:30,duration:240,onShow:instance=>{var popper=instance.popper;var elem=instance.reference;if(prevInstance){prevInstance.hide()}prevInstance=instance;var userid=$(elem).data(DATA_KEY_USERID);if(!userid){return}currentUserid=userid.toLowerCase();var json=USER_DATA[currentUserid];if(json){setData(tip,popper,json,instance)}else{$.get({url:"/ajax/gamercard.php",data:{u:currentUserid},beforeSend:function(jqXHR,settings){instance.setContent(HTML_PROGRESS)}}).done(json=>{USER_DATA[currentUserid]=json;if(currentUserid==json["userid"].toLowerCase()){setData(tip,popper,json,instance)}})}}})}else{var tip=tippy(tippySelector,{html:"#"+TEMPLATE_ID,position:"top-start",arrowSize:"big",arrow:true,delay:600,hideDelay:300,theme:"light",interactive:true,interactiveBorder:30,duration:240,onShow:function(){var popper=this;var elem=tip.getReferenceElement(popper);if(prevPopper){tip.hide(prevPopper)}prevPopper=popper;var userid=$(elem).data(DATA_KEY_USERID);if(!userid){return}currentUserid=userid.toLowerCase();var json=USER_DATA[currentUserid];if(json){setData(tip,popper,json)}else{$.get({url:"/ajax/gamercard.php",data:{u:currentUserid},beforeSend:function(jqXHR,settings){$(".usercard").html(HTML_PROGRESS);tip.update(popper)},success:function(json){var elem=tip.getReferenceElement(popper);USER_DATA[currentUserid]=json;if(currentUserid==json["userid"].toLowerCase()){setData(tip,popper,json)}}})}}})}};const HTML_PROGRESS='<img class="usercard__progress" src="https://i2.bahamut.com.tw/mobile/loading.svg">';const HTML_ERROR='<i class="usercard__progress material-icons">error</i>';const HTML_GAMERCARD='        <div class="usercard__background">          <img>        </div>        <a class="usercard__avatar" target="_blank">          <img>        </a>        <div class="usercard__data">          <div class="usercard-name">            <div class="usercard-level"></div>            <div class="usercard-username">              <p class="usercard-label-name"></p>              <a class="usercard-label-id" target="_blank"></a>            </div>          </div>          <ul class="usercard-info">            <li class="usercard-nickname">              <label>稱號</label>              <p></p>            </li>            <li class="usercard-race">              <label>種族</label>              <p></p>            </li>            <li class="usercard-coin">              <label>巴幣</label>              <p></p>            </li>            <li class="usercard-gp">              <label>GP</label>              <p></p>            </li>            <li class="usercard-coin usercard-donate">              <label>被贊助</label>              <p></p>            </li>          </ul>          <div class="usercard-achieve">            <div class="usercard-slick-item">            </div>            <div class="usercard-slick-controller">              <button class="usercard-slick-prev"><i class="material-icons">keyboard_arrow_left</i></button>              <button class="usercard-slick-next"><i class="material-icons">keyboard_arrow_right</i></button>            </div>          </div>        </div>        <div class="usercard__option">          <a class="usercard-button-message" target="_blank">            <i class="material-icons">mail_outline</i>            <span>寫信</span>          </a>          <a class="usercard-button-im" href="javascript:;">            <i class="material-icons">sms</i>            <span>私訊</span>          </a>        </div>';function setData(tip,popper,json,instance){var contentDiv=$(".usercard");if("code"in json&&"message"in json){contentDiv.html(HTML_ERROR);return}var invalidUser=json["avatar_level"]==="??";var homeUrl=invalidUser?"javascript:;":"https://home.gamer.com.tw/"+json["userid"];var mailUrl="https://mailbox.gamer.com.tw/send.php?to="+json["userid"];contentDiv.html(HTML_GAMERCARD);contentDiv.find(".usercard__background img").attr("src",json["brand_image"]);contentDiv.find(".usercard__avatar").attr("href",homeUrl).find("img").attr("src",json["avatar_image"]);contentDiv.find(".usercard-level").addClass(json["avatar_level_class"]).text(json["avatar_level"]);contentDiv.find(".usercard-username .usercard-label-name").html(json["nickname"]);if(!invalidUser){contentDiv.find(".usercard-username .usercard-label-id").attr("href",homeUrl).text(json["userid"])}contentDiv.find(".usercard-info").find(".usercard-nickname p").text(json["avatar_title"]).end().find(".usercard-race p").text(json["avatar_race"]).end().find(".usercard-coin p").text(json["gold"]).end().find(".usercard-coin.usercard-donate p").text(json["donate_total_item"]).end().find(".usercard-gp p").text(json["gp"]);if(invalidUser){contentDiv.find(".usercard__option").hide()}else{if(typeof BAHAID!="undefined"){var self_userid=BAHAID}else{var self_userid=User.Login.getUserid()}contentDiv.find(".usercard__option").find(".usercard-button-im").attr("onclick",'GamerCard.showIm("'+self_userid+'","'+json["userid"]+'")').end().find(".usercard-button-message").attr("href",mailUrl).end().show()}var honorHtml="";for(var i in json["avatar_honor"]){var honor=json["avatar_honor"][i];honorHtml+='<a href="javascript:;"><img src="'+honor["image"]+'"></a>'}contentDiv.find(".usercard-achieve .usercard-slick-item").html(honorHtml);if(instance){instance.setContent(contentDiv.prop("outerHTML"))}else{tip.update(popper)}setTimeout(()=>{if(instance){popper=instance.popper}const slicker=$(popper).find(".usercard-slick-item");if(!slicker.hasClass("slick-initialized")){slicker.slick({infinite:false,slidesToShow:8,slidesToScroll:1,swipeToSlide:true,autoplay:true,prevArrow:$(popper).find(".usercard-slick-prev"),nextArrow:$(popper).find(".usercard-slick-next")})}},1)}GamerCard.prototype.showIm=function(auser,buser){if(typeof auser=="string"&&auser&&typeof buser=="string"&&buser){var auser=auser.toLowerCase();var buser=buser.toLowerCase();if(auser>buser){var roomid=buser+"_"+auser}else{var roomid=auser+"_"+buser}if(typeof im_layout=="object"&&im_layout.name=="full"){im.hotRoom(roomid)}else{window.open("https://haha.gamer.com.tw/index2.php?room="+roomid,roomid,"width=420px, height=750px")}}else{Dialogify.alert("請先登入才能進行此動作",{close:()=>{location.href="https://user.gamer.com.tw/login.php"}})}};if(INIT_DOM_READY){$(function(){window.GamerCard&&window.GamerCard.bind()})}window.GamerCard=new GamerCard})(jQuery,window);