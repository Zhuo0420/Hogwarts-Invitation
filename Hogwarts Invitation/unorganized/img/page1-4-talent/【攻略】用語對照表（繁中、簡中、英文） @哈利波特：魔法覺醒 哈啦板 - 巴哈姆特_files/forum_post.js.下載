(function($,window){var ForumPost={post:function(){ForumPost.checkSubboard();ForumPost.checkTitle();if(!$(".BH-menu__post__btn a").hasClass("is-active")){return}var ptype=$('input[name="ptype"]');if($("#check-re:checked").length&&$("#check-mail:checked").length){ptype.val(2)}else if($("#check-re:checked").length){ptype.val(3)}else if($("#check-mail:checked").length){ptype.val(1)}else{toastr.error("至少需選擇一種回覆方式");return}var usedSsn=[];$(".post__template__item").each(function(){if($(this).data("used")){var ssn=parseInt($(this).data("ssn"),10);if(!isNaN(ssn)){usedSsn.push(ssn)}}});var form=$("#form1");for(var i=0;i<usedSsn.length;i++){form.append('<input type="hidden" name="usedSsn[]" value="'+usedSsn[i]+'">')}ForumPost.setupThumbnail();form.submit()},preview:function(){var form=document.getElementById("frmPv");if(bahaRte.getContent().match(/\[img=http:\/\/[^\]]+\]/)){toastr.info("因應安全性，即日起只支援 https 的圖片。");return}form.pv_title.value=$('[name="title"]').val();form.pv_content.value=bahaRte.getContent();var dialog=new Dialogify("#previewTemplate",{size:Dialogify.SIZE_LARGE});$(".dialogify .tab-menu").children("li").click(function(e){var index=$(this).index();$(".dialogify .tab-wrapper").children("div").hide().filter(":eq("+index+")").show();$(this).addClass("active").siblings("li").removeClass("active");var target;if(index==1){$('[name="pv_mobile"]').val("yes");target="mobilePreview"}else{args="";$('[name="pv_mobile"]').val("");target="desktopPreview"}if(!$('[name="'+target+'"]').data("posted")){form.action="/post_preview_editor.php?"+(new Date).getTime();form.target=target;form.submit();$('[name="'+target+'"]').data("posted","yes")}});$(".dialogify .tab-menu li:eq(0)").click();dialog.showModal()},bmPreview:function(type){var form=document.getElementById("frmPv");if(bahaRte.getContent().match(/\[img=http:\/\/[^\]]+\]/)){toastr.info("因應安全性，即日起只支援 https 的圖片。");return}var dialog=new Dialogify("#bmPreviewTemplate",{size:Dialogify.SIZE_LARGE});form.rtecontent.value=bahaRte.getContent();form.action="/gemadmin/bm_preview_editor.php";form.target="bmPreview";var width=0;switch(type){case"mannoce":width=938;break;case"guidance":width=760;break}$('.dialogify iframe[name="bmPreview"]').width(width);form.submit();dialog.showModal()},cancel:function(type){type=typeof type!=="undefined"?type:"post";var msgText="";switch(type){case"g2":case"bm":msgText="你確定要取消編輯並刪除備份檔嗎？";break;case"post":default:msgText="你確定要取消發文並刪除備份檔嗎？"}Dialogify.confirm(msgText,{ok:function(){window.onbeforeunload=null;window.onunload=null;$.post("/editor/delAutosave.php",{service:"forum"},function(text){if("DONE"==text){if(type=="g2"){window.close()}else{window.history.back()}}else{Dialogify.alert("系統忙碌中，請稍後再試")}})}})},backup:function(){bahaRte.utility.save()},legendPost:function(){Cookies.set("ckForumLegendPost","yes",{expires:365});window.location="post1_legend.php"+location.search},bindTitleChecker:function(){$('input[name="title"]').on("focus",function(){$(this).removeClass("is-error")}).on("blur",function(){ForumPost.checkSubboard();ForumPost.checkTitle()}).on("input",function(){var maxLength=$(".c-post__header > h3").text()=="編輯文章"?132:120;if(Forum.Common.utf8Length($(this).val())>maxLength){if(!$(this).hasClass("is-error")){$(this).addClass("is-error");toastr.warning("你的標題字數太多囉！");setReady(-READY_TITLE)}}else{if($(this).hasClass("is-error")){$(this).removeClass("is-error");setReady(READY_TITLE)}}})},initAccordion:function(){$(".postset_item h5").css("cursor","pointer").click(function(e){$(this).next("ul").slideToggle(200);$(this).find("i").toggleClass("is-slideup");var index=$(this).parents(".postset_item").index()+1;var value=$(this).find("i").hasClass("is-slideup");accordionSetting(index,value)});var setting=accordionSetting();for(var key in setting){if(setting[key]===true){$(".postset_item:nth-child("+key.substring(1)+")").find("ul").hide().end().find("h5 i").addClass("is-slideup")}}},initSlick:function(){if($("#thumbnail_preview").length==0){return}$("#thumbnail_preview ul").slick({prevArrow:$("#thumbnail_preview .post-prev-btn"),nextArrow:$("#thumbnail_preview .post-next-btn")});if(!$("#use-thumb").is(":checked")){$("#thumbnail_preview .c-post__body").hide()}$("#use-thumb").change(function(e){$("#thumbnail_preview .c-post__body").toggle();if($("#use-thumb").is(":checked")){$("#thumbnail_preview ul").trigger("resize")}})},setupThumbnail:function(){var currentSlide=$("#thumbnail_preview ul").slick("slickCurrentSlide");var slide=$("#thumbnail_preview ul li:not(.slick-cloned):eq("+currentSlide+")");if(slide.length==0){return}var thumbnail=slide.data("thumbnail").replace(/[-[\]{}()*+?.,\\/^$|#\s]/g,"\\$&");if(bahaRte.isPlainText){var pattern=new RegExp("(\\[(?:img|movie)="+thumbnail+")([^\\]]*?\\])");var content=bahaRte.source.value;content=content.replace(/(\[(?:img|movie)=[^\]]*?) thumbnail=yes([^\]]*?\])/g,"$1$2");bahaRte.source.value=content.replace(pattern,"$1 thumbnail=yes$2")}else{var content=bahaRte.doc.body.innerHTML;content=content.replace(/(<img [^>]*?)data-thumbnail="yes"([^>]*?>)/g,"$1$2");var matches,pattern;if(matches=slide.data("thumbnail").match(/^https:\/\/i1\.ytimg\.com\/vi\/([0-9a-zA-Z_-]{11})\/hqdefault\.jpg$/)){pattern=new RegExp('(<img [^>]*?data-movie="https:\\/\\/www\\.youtube\\.com\\/watch\\?v='+matches[1]+'")([^>]*?>)')}else{pattern=new RegExp('(<img [^>]*?src="'+thumbnail+'")([^>]*?>)')}bahaRte.doc.body.innerHTML=content.replace(pattern,'$1 data-thumbnail="yes"$2')}if($("#thumbnail_preview:visible").length){$('input[name="thumbnail"]').val(slide.data("thumbnail"))}},checkTitle:function(){var title=$('input[type="text"][name="title"]');if(!title.length){setReady(READY_TITLE);return}var maxLength=$(".c-post__header > h3").text()=="編輯文章"?132:120;if(title.val()==""||Forum.Common.utf8Length(title.val())>maxLength){title.addClass("is-error");setReady(-READY_TITLE)}else{setReady(READY_TITLE)}},checkSubboard:function(){var subboard=$('select[name="nsubbsn"]');if(subboard.prop("selectedIndex")==0){subboard.addClass("is-error");setReady(-READY_SUBBOARD)}else{subboard.removeClass("is-error");setReady(READY_SUBBOARD)}},tourPost:function(){var tour=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",showCancelLink:true}});tour.on("start",function(){showOverlay()});tour.on("complete",function(){removeOverlay()});tour.on("cancel",function(){removeOverlay()});tour.addStep("step1",{text:'<img width="600" height="480" src="https://i2.bahamut.com.tw/forum/firstpost.jpg">',buttons:{text:"下一個",action:tour.next}});tour.addStep("step2",{text:"動作按鈕置頂，方便你隨時備份、預覽、發佈文章。",attachTo:{element:".BH-menu-forumA-right",on:"bottom"},title:"三大功能常駐",buttons:{text:"下一個",action:tour.next}});tour.addStep("step3",{text:"方便你在文章中嵌入圖片、影片和表情符號。",attachTo:{element:".side_gray_box.box-shadow__shallow:first-child",on:"bottom"},title:"常駐插入功能",buttons:{text:"我知道了",action:tour.next}});tour.start()},applyDarenStep1:function(bsn,boardName){var step1=new Dialogify("#darenStep1Template",{size:Dialogify.SIZE_LARGE,closable:false});var title='申請哈啦區達人 <a class="post__text-small" href="https://forum.gamer.com.tw/C.php?bsn=60404&snA=13408" target="_blank">'+'<img src="https://i2.bahamut.com.tw/forum/icons/pixel-Q.svg">詳細申請方式說明</a>';$("#applyDarenBoard").text(boardName);step1.title(title).buttons(['<div class="check-group text-left">'+'<input id="daren-agree" type="checkbox" checked="checked">'+'<label for="daren-agree">'+'<div class="label-icon"><i class="fa fa-check"></i></div>'+'<h6>我已閱讀且同意<a href="https://forum.gamer.com.tw/C.php?bsn=60404&snA=13408" target="_blank">申請規範</a></h6>'+"</label></div>",{text:"取消",click:function(){this.close()}},{text:"下一步",type:Dialogify.BUTTON_PRIMARY,click:function(e){if(!$("#daren-agree").prop("checked")){Dialogify.alert("請勾選已閱讀且同意哈啦板達人申請規範");e.preventDefault();return}ForumPost.applyDarenStep2(bsn,boardName)}}]).showModal()},applyDarenStep2:function(bsn,boardName){var dialog=new Dialogify("#darenStep2Template",{size:Dialogify.SIZE_LARGE,closable:false});var title='申請哈啦板達人<a class="post__text-small" href="https://forum.gamer.com.tw/C.php?bsn=60404&snA=13408" target="_blank">'+'<img src="https://i2.bahamut.com.tw/forum/icons/pixel-Q.svg">詳細申請方式說明</a>';$("#daren_memo, #daren_introduction").on("input",function(e){var memo=$("#daren_memo").val();var intro=$("#daren_introduction").val();if(!memo||!intro){dialog.$buttonList[2].disable()}else{dialog.$buttonList[2].enable()}});dialog.title(title).buttons(['<div class="float-left"><a class="btn btn-insert btn-primary" href="javascript:;">上一步</a></div>',{text:"取消",click:function(){this.close()}},{text:"確認送出",type:Dialogify.BUTTON_PRIMARY,disabled:true,click:function(e){if(!$("#daren_memo").val()){Dialogify.alert("請附三篇以上相關作品連結！");e.preventDefault();return}if(!$("#daren_introduction").val()){Dialogify.alert("請簡單說明你擅長的領域及文章類型！");e.preventDefault();return}var params={bsn:bsn,daren_agree:"T",daren_memo:$("#daren_memo").val(),daren_introduction:$("#daren_introduction").val()};$.post("/ajax/daren_apply.php",params,function(resp){Dialogify.alert(resp)})}}]).on("show",function(){$("#daren_memo").focus();var dialog=this;this.$buttonList[0].find(".btn").click(function(){dialog.close();ForumPost.applyDarenStep1(bsn,boardName)})}).showModal()},bindCCAnnounce:function(){var checkCc=$("#check-cc");checkCc.change(function(){if(checkCc.is(":checked")){$(".cc-description").show()}else{$(".cc-description").hide()}});if(checkCc.is(":disabled")){$('label[for="check-cc"] > h6 > a').attr("href","http://creativecommons.tw/explore").attr("target","_blank").html("作者標示-非商業性")}},onSubjectChange:function(elem){if(window.localStorage.getItem(DONATE_NOTICE_LOCALSTORAGE_KEY)=="yes"||$("#check-donate").prop("checked")||!$(".check-group-donate").length||![2,4].includes(elem.selectedIndex)){return}new Dialogify('<p>未開啟「<span style="color:#f03434;font-weight:bold;">開放贊助</span>」，是否要開啟，</p><p>來獲得現金回饋呢？</p>').buttons(['<label for="ignoreNotice"><input type="checkbox" id="ignoreNotice" onchange="Forum.Post.onDonateIgnoreNoticeChange(this);"> 不再提醒我</label>',{text:"略過",click:function(e){this.close()}},{text:"開啟贊助",type:Dialogify.BUTTON_PRIMARY,click:function(e){$("#check-donate").prop("checked",true)}}]).showModal()},onDonateIgnoreNoticeChange:function(elem){if(elem.checked){window.localStorage.setItem(DONATE_NOTICE_LOCALSTORAGE_KEY,"yes")}else{window.localStorage.removeItem(DONATE_NOTICE_LOCALSTORAGE_KEY)}},generateVoteInputFromVoteDetail:function(voteDetail){nunjucks.configure();let inputHtml=nunjucks.render("vote_input.njk.html",voteDetail);$("#form1").append(inputHtml);$("#frmPv").append(inputHtml);let previewHtml=nunjucks.render("vote_preview.njk.html",voteDetail);$(".main_editor_section > .c-post__body").append(previewHtml);if(voteDetail["is_end"]==0&&voteDetail["editAble"]==0){voteCountDown(parseInt(voteDetail["countDownTimestamp"],0))}},createOrEditVote:function(){nunjucks.configure();let voteInput=getVoteInput();let dialogHtml=nunjucks.render("vote_dialog.njk.html",voteInput);let dialog=new Dialogify(dialogHtml,{useDialogForm:false,closable:false}).buttons([{text:Dialogify.LOCALE["zh_TW"].cancel,click:function(){this.close()}},{text:Dialogify.LOCALE["zh_TW"].ok,type:Dialogify.BUTTON_PRIMARY,click:function(){if(checkVoteParameter(this)){generateVoteInputFromDialog(this);this.close()}}}]).on("close",()=>{$("#dialogify_mask_style").remove();$("#dialogify_mask").remove()}).title(voteInput.default?"建立投票":"編輯投票");let $titleInput=dialog.$content.find('input[name="title"]');$titleInput.keyup(function(){let $elem=$(this);$elem.prev("small").text($elem.val().length+"/50字")});$titleInput.prev("small").text($titleInput.val().length+"/50字");dialog.$content.find('input[name="options[]"]').each(function(){bindOptionEvent(dialog,$(this).parent())});let optionBlock=dialog.$content.find(".editor__vote").get(0);new Sortable(optionBlock,{animation:150,handle:".handle-img",draggable:".vote-item"});let $addBtn=dialog.$content.find(".add-vote a");$addBtn.click(()=>{let $prevOption=dialog.$content.find('input[name="options[]"]').last().parent();generateOption(dialog,$prevOption)});let $etimeInput=dialog.$content.find('input[name="etime"]');$etimeInput.datepicker({dateFormat:"yy-mm-dd",minDate:0,maxDate:31});let mask=$("<div></div>");mask.attr("id","dialogify_mask").css({position:"fixed",top:"0px",left:"0px",zIndex:100,backgroundColor:"black",width:"100%",height:"100%",opacity:.7});$("body").append(mask);$('<style id="dialogify_mask_style">.dialogify.fixed {z-index: 101 !important;}</style>').appendTo("head");dialog.show()},deleteVote:function(){Dialogify.confirm("投票刪除後無法復原，確定要刪除嗎？",{ok:()=>{deleteVoteInput();$("#form1").append(`<input type="hidden" name="vote-delete" value="1">`)}})}};function getVoteInput(){let $form=$("#form1");let title=$form.find('input[name="vote-title"]');title=title.length==0?"":title.val();let etime=$form.find('input[name="vote-etime"]');etime=etime.length==0?"":etime.val();let choiceLimit=$form.find('input[name="vote-choiceLimit"]');choiceLimit=choiceLimit.length==0?"1":choiceLimit.val();let anonymous=$form.find('input[name="vote-anonymous"]');anonymous=anonymous.length==0?"1":anonymous.val();let live=$form.find('input[name="vote-live"]');live=live.length==0?"1":live.val();let options=$form.find('input[name="vote-options[]"]');let optionsTest=[];if(options.length>0){options.each(function(){optionsTest.push($(this).val())})}else{optionsTest.push("");optionsTest.push("")}return{default:$form.find('input[name="vote-title"]').length==0,title:title,etime:etime,choiceLimit:choiceLimit,anonymous:anonymous,live:live,options:optionsTest}}function generateVoteInputFromDialog(dialog){deleteVoteInput();$("#createOrEditVote").find("h6").text("編輯投票");let title=dialog.$content.find('input[name="title"]').val();let etime=dialog.$content.find('input[name="etime"]').val();let choiceLimit=dialog.$content.find("#choiceLimit option:selected").val();let anonymous=dialog.$content.find("input[name=anonymous]:checked").val();let live=dialog.$content.find("input[name=live]:checked").val();let options=[];dialog.$content.find('input[name="options[]"]').each(function(){options.push($(this).val())});ForumPost.generateVoteInputFromVoteDetail({editAble:1,is_end:0,title:title,etime:etime,choiceLimit:choiceLimit,anonymous:anonymous,live:live,options:options})}function checkVoteParameter(dialog){let $errorMessage=dialog.$content.find("#errorMessage");let $title=dialog.$content.find('input[name="title"]');$title.removeClass("is-error");if($title.val().length==0||$title.val().length>50){$errorMessage.text("標題空白或太長，請修改後再發佈");$title.addClass("is-error");$title.focus();return false}let $etime=dialog.$content.find('input[name="etime"]');$etime.removeClass("is-error");if($etime.val().length!=10){$errorMessage.text("投票結束日空白或格式錯誤，請修改後再發佈");$etime.addClass("is-error");$etime.focus();return false}let $choiceLimit=dialog.$content.find("#choiceLimit option:selected");let $options=[];dialog.$content.find('input[name="options[]"]').each(function(){$(this).removeClass("is-error");$options.push($(this))});$choiceLimit.parent().removeClass("is-error");if($choiceLimit.val()>$options.length){$errorMessage.text("多選數量大於選項數量，請重新確認。");$choiceLimit.parent().addClass("is-error");$choiceLimit.focus();return false}if($options.length>20){$errorMessage.text("投票選項過多(最多 20 項)");return false}for(let index=0;index<$options.length;index++){let $option=$options[index];if($option.val().length==0||$option.val().length>50){$errorMessage.text("選項空白或太長，請修改後再發佈 (最多 50 字)");$option.addClass("is-error");$option.focus();return false}}return true}function deleteVoteInput(){$('#form1 input[name|="vote"]').remove();$('#frmPv input[name|="vote"]').remove();$(".main_editor_section > .c-post__body .vote-block").remove();$("#createOrEditVote").find("h6").text("創建投票")}function generateOption(dialog,$prevOption){if(dialog.$content.find('input[name="options[]"]').length>=20){let $errorMessage=dialog.$content.find("#errorMessage");$errorMessage.text("投票選項最多 20 項");return}let newOption=nunjucks.render("vote_option.njk.html",{options:""});let $newOption=$(newOption);bindOptionEvent(dialog,$newOption);$prevOption.after($newOption);$newOption.find("input").focus()}function bindOptionEvent(dialog,$optionElem){let compositionStatus=false;$optionElem.find("a").click(function(){let $optionInputElem=$(this);deleteOption(dialog,$optionInputElem.parent())});$optionElem.find("input").on("compositionstart",()=>{compositionStatus=true}).on("compositionend",()=>{compositionStatus=false}).keydown(function(event){switch(event.which||event.keyCode){case 8:let $optionInputElem=$(this);if($optionInputElem.val().length==0){deleteOption(dialog,$optionInputElem.parent());event.preventDefault()}break;case 13:if(compositionStatus){return}generateOption(dialog,$(this).parent());break}})}function voteCountDown(countDownTimestamp){let timestamp=countDownTimestamp;let sec=timestamp%60;if(sec<10){sec="0"+sec}timestamp=Math.floor(timestamp/60);let min=timestamp%60;if(min<10){min="0"+min}timestamp=Math.floor(timestamp/60);let hour=timestamp%24;if(hour<10){hour="0"+hour}let day=Math.floor(timestamp/24);if(day<10){day="0"+day}$("#countDown").text(`${day}天 ${hour}:${min}:${sec}`);countDownTimestamp=countDownTimestamp-1;if(countDownTimestamp<0){return}setTimeout(voteCountDown,1e3,countDownTimestamp)}function deleteOption(dialog,$optionElem){if(dialog.$content.find('input[name="options[]"]').length>2){$optionElem.prev().find("input").focus();$optionElem.remove()}}const READY_SUBBOARD=1;const READY_TITLE=2;const DONATE_NOTICE_LOCALSTORAGE_KEY="DONATE_ignore_notice";var ready;function setReady(value){if(value<0){value=Math.abs(value);if(ready&value){ready-=value}}else{ready|=value}var button=$(".BH-menu__post__btn a");if(ready==READY_SUBBOARD+READY_TITLE){button.addClass("is-active")}else{button.removeClass("is-active")}}function showOverlay(){$("<div />").addClass("tour-overlay").attr("id","tourOverlay").appendTo("body")}function removeOverlay(){$("#tourOverlay").remove()}function accordionSetting(index,value){const KEY="FORUM_POST_accordion";var setting=window.localStorage.getItem(KEY);if(!setting){setting={}}else{setting=JSON.parse(setting)}if(index!==undefined&&value!==undefined){setting["a"+index]=value;window.localStorage.setItem(KEY,JSON.stringify(setting))}else{return setting}}window.Forum=window.Forum||{};window.Forum.Post=ForumPost})(jQuery,window);(function($,window){var ForumEditor={dialogInst:null,savedSelection:null,initEmoticonPanel:function(){var container=$("#fe_emoticon .postaddemoji-list");var setCount=[11,12,10,10];var eid=1;for(var set in setCount){var box=$("<div />").addClass("emoji-list__box");container.append(box);for(var i=0;i<setCount[set];i++){var emo=$("<a />").attr("href","javascript:;").on("mousedown",bahaRte.toolbar.insertEmotion);var emoImage=$("<img />").addClass("lazyload").attr("data-src","https://i2.bahamut.com.tw/editor/emotion/"+(i+eid)+".gif").appendTo(emo);box.append(emo)}eid+=setCount[set]}},emoticonPanel:function(e,elem){bahaRte.win.focus();e.preventDefault();e.stopPropagation();jQuery("#fe_balloon_toolbar:visible").fadeOut(200);var offset=$(elem).offset();$("#fe_emoticon").css({top:offset.top-40,left:offset.left-$("#BH-wrapper").offset().left+25}).off("mousedown").on("mousedown",function(e){e.preventDefault();e.stopPropagation()}).slideToggle(200);$("body").on("mousedown",function(e){ForumEditor.hidePanel();e.preventDefault();e.stopPropagation()})},colorPanel:function(e,elem){bahaRte.win.focus();e.preventDefault();e.stopPropagation();var prevId=$("#fe_color_picker").data("id");var currId=$(elem).prev("button").data("id");if(prevId!==undefined){ForumEditor.hidePanel();if(prevId==currId){return}else{$("#fe_color_picker").hide()}}var parentoffset=$("#fe_color_picker").parent().offset();var offset=$(elem).offset();$("#fe_color_picker").css({left:offset.left-parentoffset.left,top:offset.top-parentoffset.top+36}).off("mousedown").on("mousedown",function(e){e.preventDefault();e.stopPropagation()}).data("id",currId).slideDown(200).find('span[role="button"]').off("mousedown").on("mousedown",function(e){e.preventDefault()}).off("mouseup").on("mouseup",function(e){e.preventDefault();ForumEditor.hidePanel();var color=$(this).data("value");if(currId=="_bhrte_forecolor"){bahaRte.toolbar.setForeColor(color)}else{bahaRte.toolbar.setBackgroundColor(color)}});$(elem).addClass("is-active");$("body").on("mousedown",function(e){ForumEditor.hidePanel();e.preventDefault();e.stopPropagation()})},hidePanel:function(){$(".fe_panel:visible").slideUp(200);$("#fe_color_picker").removeData("id");$(".editor-button.editor-button__s.is-active").removeClass("is-active");$("body").off("mousedown")},initDropdownList:function(){$(".js-link").mousedown(function(e){bahaRte.win.focus();Forum.Editor.hidePanel();var list=$(this).next(".js-dropdown-list");var visibleList=$(".js-dropdown-list:visible");if(visibleList.length&&visibleList.prev(".js-link").data("id")!=$(this).data("id")){visibleList.slideUp(200)}if(list.is(":hidden")){$("body").on("mousedown",function(e){$("body").off("mousedown");list.slideUp(200);e.preventDefault();e.stopPropagation()})}list.slideToggle(200);e.preventDefault();e.stopPropagation()}).next(".js-dropdown-list").find("li").on("mousedown",function(e){e.preventDefault();e.stopPropagation()}).on("mouseup",function(e){bahaRte.win.focus();var list=$(this).parent(".js-dropdown-list");var dropdownId=list.prev("a.js-link").data("id");switch(dropdownId){case"fe_header":bahaRte.toolbar.insertHeading(this);break;case"fe_fontsize":bahaRte.toolbar.setSize(this);break;case"fe_font":bahaRte.toolbar.setFont(this);break;default:}$('[data-id="'+dropdownId+'"] span').text($(this).text());list.slideToggle(200);e.preventDefault();e.stopPropagation()});$(".editor-button__viewmore").mousedown(function(e){var outbox=$(this).next(".editor-toolbar__outerbox");if(outbox.hasClass("is-hidden")){$(".editor-toolbar__outerbox").addClass("is-hidden");var winW=$(window).width();var boxW=outbox.width();var left=-(boxW/2-$(this).width()/2-4);outbox.removeClass("is-hidden").css("left",left);var offset=outbox.offset();if(offset.left<0){left-=offset.left}else if(offset.left+boxW>winW){left-=offset.left+boxW-winW}outbox.css("left",left)}else{outbox.addClass("is-hidden")}e.preventDefault();e.stopPropagation()})},bindToolbarClick:function(){$(".editor-button:not(.editor-button__s,.editor-button__viewmore,.dropdown-group,.fe_source)").mousedown(function(e){bahaRte.toolbar.buttonClick(e,this)});$(".editor-button__s").mousedown(function(e){Forum.Editor.colorPanel(e,this)});$(".fe_source").mousedown(function(e){bahaRte.toolbar.alternateView(true);e.preventDefault();e.stopPropagation()})},onPaste:function(e,text){var regex=/https?:\/\/[^\s]+/g;var ie11=/trident\/.*rv:([0-9]{1,}[.0-9]{0,})/;var matches=text.match(regex);if(!matches||matches.length==0){return}var str=text;matches.forEach(function(match){var split=str.split(match);var chars=split.shift();if(navigator.userAgent.toLowerCase().match(ie11)){bahaRte.utility.insertHtml(chars.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\r/g,"<br>"))}else{bahaRte.doc.execCommand("inserttext",false,chars.replace(/\r\n/g,"\n").replace(/\r/g,"\n"))}var isImage=match.match(/\.(?:png|jpg|jpeg|gif)$/i);var videoUrl=matchVideoUrl(match);if(!isImage&&!videoUrl){var html='<a href="'+match+'">'+match+"</a>";bahaRte.utility.insertHtml(html)}else if(videoUrl){bahaRte.toolbar.insertMovie(null,videoUrl)}else{var imageUrl=match;if(!imageUrl.match(/^https:\/\//)){imageUrl=Util.HttpImgFilter.forceToHttps(imageUrl)}if(imageUrl){bahaRte.toolbar.insertImage(null,imageUrl)}else{var html='<a href="'+match+'">'+match+"</a>";bahaRte.utility.insertHtml(html)}}str=split.join(match)});if(navigator.userAgent.toLowerCase().match(ie11)){bahaRte.utility.insertHtml(str.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\r/g,"<br>"))}else{bahaRte.doc.execCommand("inserttext",false,str.replace(/\r\n/g,"\n").replace(/\r/g,"\n"))}Forum.Editor.detectThumbnail();e.preventDefault()},onSignChange:function(sign,userid){var signView=$(".postset_signature");if(sign==0){signView.slideUp(200)}else{userid=userid.toLowerCase();var src="https://gc.bahamut.com.tw/sign/html/";src+=userid.charAt(0)+"/"+userid.charAt(1)+"/"+userid+"_"+sign+".html";signView.find("iframe").attr("src",src);signView.slideDown(200)}},detectThumbnail:function(init){var content=bahaRte.isPlainText?bahaRte.source.value:bahaRte.doc.body.innerHTML;if(!content){return}var matches,images=[];var youtubePattern=/https?:\/\/www\.youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})/g;matches=youtubePattern.exec(content);while(matches){images.push("https://i1.ytimg.com/vi/"+matches[1]+"/hqdefault.jpg");matches=youtubePattern.exec(content)}if(matches=content.match(/https?:\/\/[^>"]+?\/[^>"\s]+\.(?:jpg|jpeg|png)/gi)){for(var i=0;i<matches.length;i++){if(!matches[i].match(/https?:\/\/ref\.gamer\.com\.tw/)){images.push(matches[i])}}}var slider=$("#thumbnail_preview ul");if(slider.length==0){return}$("#thumbnail_preview ul li:not(.slick-cloned)").each(function(i,item){if(images.indexOf($(item).data("thumbnail"))==-1){slider.slick("slickRemove",i)}});if(images.length){var addSlick=function(){for(var i=0;i<images.length;i++){if(slider.find('li[data-thumbnail="'+images[i]+'"]:not(.slick-cloned)').length==0){var item=$("<li>").addClass("post_img-item").css("background-image","url("+images[i]+")").attr("data-thumbnail",images[i]);slider.slick("slickAdd",item)}}if(init){var thumbnail=getThumbnailFromContent();var index=-1;if(thumbnail){$("#thumbnail_preview ul li:not(.slick-cloned)").each(function(i,item){if($(item).data("thumbnail")==thumbnail){index=i}});if(index>=0){slider.slick("slickGoTo",index,true)}}}};if($("#thumbnail_preview:visible").length){addSlick()}else{$("#thumbnail_preview:hidden").slideDown(200,addSlick)}}else{$("#thumbnail_preview:visible").slideUp(200)}},showVideoDialog:function(){var dialog=new Dialogify("#insertVideoTemplate",{closable:false});$("#_bhrte_movieCode").on("input",function(e){bahaRte.dialog.previewMovie()});ForumEditor.initInputBoxClearButton();ForumEditor.dialogInst=dialog;ForumEditor.saveSelection();var imageInfo=bahaRte.selection.getSelectedImageInfo();dialog.title("嵌入影片").buttons([{text:"取消",click:function(){this.close();ForumEditor.restoreSelection()}},{text:"插入影片",type:Dialogify.BUTTON_PRIMARY,click:bahaRte.toolbar.insertMovie,disabled:true}]).on("show",function(){if(imageInfo.movie){$("#_bhrte_movieCode").val(imageInfo.movie).trigger("input")}}).showModal()},showTableDialog:function(){var dialog=new Dialogify("#insertTableTemplate",{closable:false});ForumEditor.dialogInst=dialog;dialog.title("新增表格");$("#_bhrte_tbborder, #_bhrte_tbalign").click(function(e){var list=$(this).next(".js-dropdown-list");var visibleList=$(".js-dropdown-list:visible");if(visibleList.length&&visibleList.prev("a").attr("id")!=$(this).attr("id")){visibleList.slideUp(200)}list.slideToggle(200);e.preventDefault();e.stopPropagation()}).next(".js-dropdown-list").find("li").on("click",function(e){var list=$(this).parent(".js-dropdown-list");var dropdownId=list.prev("a").attr("id");$("#"+dropdownId).data("value",$(this).data("value")).find("span").text($(this).text());list.slideUp(200);e.preventDefault();e.stopPropagation()});if(!bahaRte.isPlainText){var table=bahaRte.selection.getSelectedNode();while(!table.nodeName.inArray(["table","body"],true)){table=table.parentNode}if(table.nodeName.equals("table")){var border=parseInt(table.getAttribute("border"),10)||0;var align=table.getAttribute("align")||0;var height=table.style.height||table.getAttribute("height")||"";var width=table.style.width||table.getAttribute("width")||"";var alignMap={0:0,left:1,center:2,right:3};$("#_bhrte_tbrow,#_bhrte_tbcol").prop("disabled",true).val("");$("#_bhrte_tbborder").next(".js-dropdown-list").find("li:eq("+border+")").click();$("#_bhrte_tbalign").next(".js-dropdown-list").find("li:eq("+alignMap[align]+")").click();$("#_bhrte_tbcellpadding").val(parseInt(table.getAttribute("cellPadding"),10)||"");$("#_bhrte_tbcellspacing").val(parseInt(table.getAttribute("cellSpacing"),10)||"");$("#_bhrte_tbwidth").val(width.replace("px","").replace("%",""));$("#_bhrte_tbheight").val(height.replace("px",""));$("#_bhrte_tbIsModify").val("yes");dialog.title("設定表格屬性")}}ForumEditor.saveSelection();dialog.buttons([{text:"取消",click:function(){this.close();ForumEditor.restoreSelection()}},{text:"確定",type:Dialogify.BUTTON_PRIMARY,click:bahaRte.toolbar.insertTable}]).showModal()},showTableCellDialog:function(){var dialog=new Dialogify("#editTableCellTemplate");var td=bahaRte.selection.getSelectedCells();if(td){td=td[0];var height=td.style.height||td.getAttribute("height")||"";var width=td.style.width||td.getAttribute("width")||"";$("#_bhrte_cellwidth").val(width.replace("px","").replace("%",""));$("#_bhrte_cellheight").val(height.replace("px",""))}ForumEditor.dialogInst=dialog;ForumEditor.saveSelection();dialog.title("設定儲存格寬高").buttons([{text:"取消",click:function(){this.close();ForumEditor.restoreSelection()}},{text:"確定",type:Dialogify.BUTTON_PRIMARY,click:bahaRte.table.setCellAttr}]).showModal()},showLinkDialog:function(){var dialog=new Dialogify("#createLinkTemplate",{closable:false});var selection=bahaRte.selection;var anchorInfo=selection.getSelectedAnchorInfo();var linktext=bahaRte.selection.getSelectedText();ForumEditor.initInputBoxClearButton();ForumEditor.dialogInst=dialog;ForumEditor.saveSelection();dialog.title("建立／刪除連結").buttons(['<div id="_bhrte_displayUnlink" class="float-left" style="display:none;"><a href="javascript:bahaRte.toolbar.removeLink();">移除連結</a></div>',{text:"取消",click:function(){this.close();ForumEditor.restoreSelection()}},{text:"確定",type:Dialogify.BUTTON_PRIMARY,click:bahaRte.toolbar.createLink,disabled:true}]).on("show",function(){if(anchorInfo.isLink){$("#_bhrte_linkurl").val(anchorInfo.url);dialog.$buttonList["_bhrte_displayUnlink"].show();linktext=anchorInfo.text}if(linktext){$("#_bhrte_linktext").parent(".input-box").hide();if(linktext.match(/^https?:\/\/.+$/)&&!anchorInfo.isLink){$("#_bhrte_linkurl").val(linktext)}}$("#_bhrte_linktext").val(linktext);$("#_bhrte_linkurl, #_bhrte_linktext").on("input",function(e){var btn=ForumEditor.dialogInst.$buttonList[2];if($("#_bhrte_linkurl").val().match(/^https?:\/\/.+$/)){btn.enable()}else{btn.disable()}}).trigger("input")}).showModal()},showColorDialog:function(){var dialog=new Dialogify("#colorTemplate");ForumEditor.dialogInst=dialog;ForumEditor.saveSelection();var isBg=$(".editor-button.editor-button__s.is-active").prev("button").data("id")=="_bhrte_bgcolor";$("#_bhrte_isBg").val(isBg);$(".color-picker .ql-picker-item").click(function(e){var color=$(this).data("value");$("#_bhrte_selectedColor").css("backgroundColor",color);$("#_bhrte_selectedColorText").val(color);$(".color-picker .ql-picker-item.is-active").removeClass("is-active");$(this).addClass("is-active");ForumEditor.dialogInst.$buttonList[2].enable()});dialog.title("選擇顏色").buttons(['<div class="picker-item__selected">'+'<span id="_bhrte_selectedColor" class="picker-item__preview" style="background-color:transparent;"></span>'+'<input id="_bhrte_selectedColorText" class="picker-item__input" type="text" placeholder="#RRGGBB">'+'<a class="post__text-small" href="javascript:Forum.Editor.clearSelectColor();">清除</a></div>',{text:"取消",click:function(){this.close();ForumEditor.restoreSelection()}},{text:"確定",type:Dialogify.BUTTON_PRIMARY,click:bahaRte.dialog.setColor,disabled:true}]).on("show",function(){var state=bahaRte.utility.getTagStatus(true);var bit=isBg?bahaRte.constants.tagState.BACKGROUNDCOLOR:bahaRte.constants.tagState.FORECOLOR;var list=isBg?state.bgcolorList:state.colorList;if(state.state&bit){$("#_bhrte_selectedColor").css("backgroundColor",list[0]);$("#_bhrte_selectedColorText").val(list[0])}}).showModal()},clearSelectColor:function(){$("#_bhrte_selectedColor").css("backgroundColor","transparent");$("#_bhrte_selectedColorText").val("");ForumEditor.dialogInst.$buttonList[2].disable()},initInputBoxClearButton:function(){$(".input-box .clearall").click(function(e){$(this).removeClass("is-active").next("input").val("")});$(".input-box input").on("input",function(e){if(!$(this).val()){$(this).prev(".clearall").removeClass("is-active")}else{$(this).prev(".clearall").addClass("is-active")}})},insertImage:function(){var elem=bahaRte.isPlainText?"#source":"#editor";var options={onInsert:function(inst){Forum.Editor.detectThumbnail()}};var insertImageInst=new Bahamut.TruthImage(options);insertImageInst.setEditor(elem);if(bahaRte.isPlainText){insertImageInst.contentCallback(function(url){return"[img="+url+"]"})}insertImageInst.showDialog()},focusEditor:function(){if(bahaRte.isPlainText){bahaRte.source.focus()}else{bahaRte.win.focus()}},saveSelection:function(){ForumEditor.focusEditor();if(bahaRte.isPlainText){ForumEditor.savedSelection={selectionStart:bahaRte.source.selectionStart,selectionEnd:bahaRte.source.selectionEnd}}else{var selection=bahaRte.win.getSelection();if(!selection||selection.rangeCount==0){savedSelection=null}var range=selection.getRangeAt(0);if(!range){savedSelection=null}ForumEditor.savedSelection={range:range}}},restoreSelection:function(){if(!ForumEditor.savedSelection){return}ForumEditor.focusEditor();if(bahaRte.isPlainText){if(ForumEditor.savedSelection.selectionStart&&ForumEditor.savedSelection.selectionEnd){bahaRte.source.selectionStart=ForumEditor.savedSelection.selectionStart;bahaRte.source.selectionEnd=ForumEditor.savedSelection.selectionEnd}}else{if(ForumEditor.savedSelection.range){var selection=bahaRte.win.getSelection();if(selection){selection.removeAllRanges();selection.addRange(ForumEditor.savedSelection.range)}}}}};function matchVideoUrl(url){var youtube=/^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})(?:.*(?:&(?:t|time_continue)=(\d+)))?/;var youtubeShare=/^https?:\/\/youtu\.be\/([0-9a-zA-Z_-]{11})(?:.*(?:(?:&|\?)(?:t|time_continue)=(\d+)))?/;var youtubeShorts=/^https?:\/\/(?:www\.)?youtube\.com\/(?:shorts|live)\/([0-9a-zA-Z_-]{11})/;var twitch=/^https?:\/\/www\.twitch\.tv\/([a-zA-Z0-9_-]+)/;var twitchVod=/^https?:\/\/www\.twitch\.tv\/videos\/([0-9]+)/;var xuite=/^https?:\/\/vlog\.xuite\.net\/play\/([a-zA-Z0-9+\/=]+)/;var nico=/^https?:\/\/www\.nicovideo\.jp\/watch\/((?:sm|nm|ca|cd|ax|yo|nl|ig|na|cw|za|zb|zc|zd|ze|om|sk|yk|so|am|fz)[0-9]{1,14}|[0-9]{10})/;var livehouse=/^https:\/\/livehouse\.in\/channel\/(\w+)/;var matches;if(matches=url.match(youtube)||url.match(youtubeShare)||url.match(youtubeShorts)){var ytUrl="https://www.youtube.com/watch?v="+matches[1];if(matches[2]){ytUrl+="&t="+matches[2]}return ytUrl}else if(matches=url.match(twitchVod)){return null}else if(matches=url.match(twitch)||url.match(xuite)||url.match(nico)||url.match(livehouse)){return matches[0]}return null}function getThumbnailFromContent(){var thumbnail;if(bahaRte.isPlainText){var content=bahaRte.source.value;var matches=content.match(/\[(?:img|movie)=(\S+)[^\]]*? thumbnail=yes[^\]]*?\]/);if(matches){thumbnail=matches[1]}}else{var content=bahaRte.doc.body.innerHTML;var matches=content.match(/<img [^>]*?data-thumbnail="yes"[^>]*?>/);if(matches){var youtube=matches[0].match(/<img [^>]*?data-movie="https:\/\/www\.youtube\.com\/watch\?v=([0-9a-zA-Z_-]{11})[^"]*?"[^>]*?>/);if(youtube){thumbnail="https://i1.ytimg.com/vi/"+youtube[1]+"/hqdefault.jpg"}else{var img=matches[0].match(/<img [^>]*?src="([^"]*?)"[^>]*?>/);if(img){thumbnail=img[1]}}}}return thumbnail||null}window.Forum=window.Forum||{};window.Forum.Editor=ForumEditor})(jQuery,window);(function($,window){var ForumSnippet={initSnippetList:function(){const KEY="FORUM_SNIPPET_list";var btn=$(".post__template__box");var box=$(".post__template");btn.on("click",function(){if(!btn.hasClass("horizon_box")){box.css({display:"block",visibility:"hidden",opacity:0,height:"37px"});btn.addClass("horizon_box").removeClass("is-close");window.localStorage.setItem(KEY,"hide")}else{box.css({visibility:"visible",opacity:1,height:"auto"});btn.removeClass("horizon_box").addClass("is-close");window.localStorage.removeItem(KEY)}});tippy(".post_template_img",{content:'<div class="tippyTemplate"></div>',allowHTML:true,arrow:false,animation:"fade",offset:[0,5],placement:"left",theme:"light",onShow:instance=>{var elem=instance.reference;let $image=$($(elem).html());$image.css("width","300px");$(instance.popper).find(".tippyTemplate").empty().append($image)}});if(window.localStorage.getItem(KEY)=="hide"){box.css({display:"block",visibility:"hidden",opacity:0,height:"37px"});btn.addClass("horizon_box").removeClass("is-close")}},initTagList:function(){$(".taglist__button").click(function(e){if($('[name="tags[]"]').length>=10){return}if($(this).hasClass("taglist__add")){showTagEdit()}else{hideTagEdit()}});$(".taglist__input").keypress(function(e){switch(e.which||e.keyCode){case 13:e.preventDefault();if(tagListTippyShown){$(this._tippy.popper).find(".tag-user.active").click()}else{ForumSnippet.addTag()}break;default:}}).keydown(function(e){switch(e.which||e.keyCode){case 38:case 40:if(tagListTippyShown){e.preventDefault();var $popper=$(this._tippy.popper);selectTagItem($popper,(e.which||e.keyCode)==38?"-1":"+1")}break;case 27:if(!tagListTippyShown){hideTagEdit()}break;default:}}).on("compositionstart",function(e){$(this).data("composing",true)}).on("compositionend",function(e){$(this).removeData("composing")}).keyup(function(e){if($(this).data("composing")){return}var keyCode=e.which||e.keyCode;if(!(keyCode==38||keyCode==40)){showTagListTippy(this,keyCode)}})},bindTitleChecker:function(){$('input[name="title"]').on("focus",function(){$(this).removeClass("is-error")}).on("blur",function(){ForumSnippet.checkTitle()});$('input[name="title"]').on("input",function(){if(Forum.Common.utf8Length($(this).val())>120){if(!$(this).hasClass("is-error")){$(this).addClass("is-error");$(".BH-menu__post__btn a").removeClass("is-active");toastr.warning("你的範本標題字數太多囉！")}}else{if($(this).hasClass("is-error")){$(this).removeClass("is-error");$(".BH-menu__post__btn a").addClass("is-active")}}});$('input[name="postTitle"]').on("input",function(){if(Forum.Common.utf8Length($(this).val())>120){if(!$(this).hasClass("is-error")){$(this).addClass("is-error");toastr.warning("你的文章標題字數太多囉！")}}else{if($(this).hasClass("is-error")){$(this).removeClass("is-error")}}})},checkTitle:function(){var title=$('input[name="title"]');var button=$(".BH-menu__post__btn a");if(title.val()==""||Forum.Common.utf8Length(title.val())>120){title.addClass("is-error");button.removeClass("is-active")}else{button.addClass("is-active")}},post:function(){ForumSnippet.checkTitle();if(!$(".BH-menu__post__btn a").hasClass("is-active")){return}var frm=document.formSnippet;if(frm.title.value.length==0||Forum.Common.utf8Length(frm.title.value)>120){toastr.error("標題空白或太長，請修改後再發佈");frm.title.focus();return}if(bahaRte.isEmpty()){toastr.error("請填寫內容");if(bahaRte.isPlainText){$("#source").addClass("is-error")}else{$("#editor").addClass("is-error")}return}if(bahaRte.getContent().match(/\[img=http:\/\/[^\]]+\]/)){toastr.error("因應安全性，即日起只支援 https 的圖片。");return}Dialogify.confirm("確定發佈範本？",{ok:function(){bahaRte.post("formSnippet",true)}})},cancel:function(){Dialogify.confirm("你確定要取消發佈範本並刪除備份檔嗎？",{ok:function(){window.onbeforeunload=null;window.onunload=null;$.post("/editor/delAutosave.php",{service:"forum"},function(text){if("DONE"==text){var loc=window.location;var matches=loc.search.match(/\?bsn=([0-9]+)/);if(matches){loc.href="https://forum.gamer.com.tw/gemadmin/snippet_manage.php?bsn="+matches[1]}}else{Dialogify.alert("系統忙碌中，請稍後再試")}})}})},addTag:function(){var elem=$(".taglist__input");var div=document.createElement("div");div.appendChild(document.createTextNode(elem.val().trim()));var text=div.innerHTML;if(!text){hideTagEdit();return}text=text.replace('"',"&quot;");var exists=false;$('[name="tags[]"]').each(function(){if(text.toLowerCase()==this.value.toLowerCase()){exists=true}});if(exists){toastr.warning("已有相同標籤");setTimeout(function(){elem.focus()},1);return}var html="<li>";html+='<div onclick="Forum.Snippet.removeTag(this);" class="taglist__tag">';html+=text+"</div>";html+='<input type="hidden" name="tags[]" value="'+text+'">';html+="</li>\n";elem.parents("li").before(html);hideTagEdit();if($('[name="tags[]"]').length>=10){$(".taglist__tools").hide()}},removeTag:function(elem){$(elem).parent("li").remove();$(".taglist__tools").show()},addTagTippy:function(elem){$(".taglist__input").val($(elem).find("span").text());ForumSnippet.addTag()},filter:function(elem,tagSn){var span=$(".post__template .js-link > span");var items=$(".post__template__item");$(".post__template .js-dropdown-list > li").removeClass("is-active");$(elem).addClass("is-active");if(tagSn==0){items.show();span.text("範本懶人包");return}span.text($(elem).text());items.each(function(){var tags=$(this).data("tags");if(tags.indexOf(tagSn)==-1){$(this).hide()}else{$(this).show()}})},deleteCheck:function(){if($('[name="snippetDel[]"]:checked').length==0){toastr.error("請選擇欲刪除的範本");return}Dialogify.confirm("確定刪除選擇的範本？",{ok:function(){window.onbeforeunload=null;window.onunload=null;$("#formSnippetDel").submit()}})},insert:function(e,ssn){e.preventDefault();Cookies.set("ckForumLastSnippet",ssn,{expires:365,domain:"gamer.com.tw"});$('.post__template__item[data-ssn="'+ssn+'"]').data("used",true);var snippet=snippetList[ssn];if(snippet["post_title"]){var elem=$('input[type="text"][name="title"]');if(elem.val()===""){elem.val(snippet["post_title"])}}if(parseInt(snippet["post_subbsn"],10)!=0){var elem=$('select[name="nsubbsn"] option[value="'+snippet["post_subbsn"]+'"]');if(elem.length){elem.prop("selected",true)}}if(parseInt(snippet["post_subject"],10)!=0){var elem=$('select[name="subject"] option[value="'+snippet["post_subject"]+'"]');if(elem.length){elem.prop("selected",true)}}if(bahaRte.isPlainText){bahaRte.source.focus();bahaRte.utility.insertTextTag(snippet["content"])}else{bahaRte.win.focus();bahaRte.utility.insertHtml(snippet["content_html"])}},toastrInfo:function(message){toastr.info(message)},supplyDialog:function(boardMaster){var html='<div class="post_template_modal">';html+='<div class="tab-box">';html+='<div class="absolutely-center">';html+='<div class="text-box">';html+="<p>相同格式的內容，總要一直複製貼上，不嫌麻煩嗎？<br/>快來<span>提供範本給板務大大</span>們吧！</p>";html+="<h5>一旦新增成功，<br/>未來在電腦版或APP上發文，都能使用<br/>方便自己，也方便同路勇者，<br/>讓發文更加暢行無阻！</h5>";html+="</div>";html+='<img src="https://i2.bahamut.com.tw/forum/post_template_img.png">';html+="</div></div></div>";var leftButton='<div class="check-group text-left">';leftButton+='<div class="post_template_info">';leftButton+='<img src="https://i2.bahamut.com.tw/forum/icons/pixel-Q.svg">';leftButton+='<h6>如何提供啊？來這兒<a href="https://forum.gamer.com.tw/C.php?bsn=60111&snA=113667" target="_blank">參考範本</a></h6>';leftButton+="</div></div>";new Dialogify(html,{size:Dialogify.SIZE_LARGE}).title("提供懶人範本讓發文更效率").buttons([leftButton,{text:"取消",click:function(e){this.close()}},{text:"聯絡板務人員",type:Dialogify.BUTTON_PRIMARY,click:function(e){var url;if(boardMaster){url="https://mailbox.gamer.com.tw/send.php?to="+boardMaster}else{url="https://forum.gamer.com.tw/B.php?bsn=60404"}window.open(url)}}]).showModal()}};var tagListTippy=null;var tagListTippyShown=false;var tagListTippyOptions={content:'<div class="tag-list"><img src="https://i2.bahamut.com.tw/mobile/loading.svg"></div>',allowHTML:true,placement:"bottom",trigger:"manual",interactive:true,theme:"light",zIndex:2,sticky:true,onShow:instance=>{tagListTippyShown=true;var elem=instance.reference;updateTagList(elem)},onShown:instance=>{var elem=instance.reference;elem.focus()},onHidden:instance=>{tagListTippyShown=false}};function showTagListTippy(elem,keyCode){if(!elem.value||tagListTippyShown){if(tagListTippyShown){if(keyCode==27||[8,33,34,35,36,37,39].indexOf(keyCode)!=-1&&!elem.value){tagListTippy.hide()}else{if([16,17,18].indexOf(keyCode)==-1){updateTagList(elem)}}}return}var offset=$(elem).position().left;tagListTippyOptions.offset=[0,offset];tagListTippyOptions.appendTo=window.document.body;tagListTippy=tippy(elem,tagListTippyOptions);tagListTippy.show()}function tagLayout(tag){return`
<li>
    <a class="tag-user" href="javascript:;" onclick="Forum.Snippet.addTagTippy(this);">
        <span class="username">${tag}</span>
    </a>
</li>`}function updateTagList(elem){if(!tagListTippyShown){return}var div=document.createElement("div");div.appendChild(document.createTextNode(elem.value.trim().toLowerCase()));var search=div.innerHTML;if(!search){tagListTippy.hide();return}var html="";for(var i=0;i<tagList.length;i++){var tag=tagList[i];if(tag["tag"].toLowerCase().indexOf(search)!=-1){html+=tagLayout(tag["tag"])}}if(html){html="<h3>現有標籤</h3><ul>"+html+"</ul>"}html+="<h3>新增標籤</h3><ul>"+tagLayout(search)+"</ul>";var $popper=$(elem._tippy.popper);$popper.find(".tag-list").html(html);var listItem=$popper.find(".tag-user");listItem.mouseenter(function(e){listItem.removeClass("active");$(this).addClass("active")});setTimeout(function(){selectTagItem($popper,0)},1)}function selectTagItem($popper,itemIndex){var items=$popper.find(".tag-user");var current=items.filter(".active");var item,index;if(items.length==0){return}if(typeof itemIndex=="string"){var diff=parseInt(itemIndex,10);index=items.index(current)+diff;if(index>=items.length){index=0}else if(index<0){index=items.length-1}}else{index=itemIndex}item=items.filter(":eq("+index+")");current.removeClass("active");item.addClass("active");var list=$popper.find(".tag-list");var top=item.position().top+list.scrollTop()-150+16;list.stop().animate({scrollTop:top},200)}function showTagEdit(){$(".taglist__button").addClass("cancel").removeClass("taglist__add");$(".taglist__input").addClass("is-active").focus();$(".taglist").addClass("edit")}function hideTagEdit(){$(".taglist__button").removeClass("cancel").addClass("taglist__add");$(".taglist__input").val("").removeClass("is-active");$(".taglist").removeClass("edit");if(tagListTippy){tagListTippy.hide()}}window.Forum=window.Forum||{};window.Forum.Snippet=ForumSnippet})(jQuery,window);